<!doctype html>
    <html lang="en-US" id="template-post" class="base">
        <head>
        
        <script defer="" data-domain="fightwithtools.dev" src="https://plausible.io/js/plausible.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Fight With Tools: A Dev Blog RSS" href="https://fightwithtools.dev/rss/">
    	<link rel="alternate" type="application/atom+xml" title="Fight With Tools: A Dev Blog Feed" href="https://fightwithtools.dev/feed/">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>XYZ Site - Day 9 - PostCSS Mods - Speed up the massive build time and decrease needed memory by limiting what CSS gets built.</title>
        
            <!-- Sub Template: post -->
        
        
            <link rel="preload" as="font">
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="preload" as="style">
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="stylesheet">
            <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=21538717504" /> -->
            <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=21538717504" id="">

            
                <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=21538717504" /> -->
                <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=21538717504" id="">

            
            <!-- Build Revision: 21538717504 & Sha: c6ad634153a263fe82b4de1d0a64fb1bc10a45b8 -->
            <script src="https://fightwithtools.dev/assets/js/scale.fix.js" async=""></script>
            <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
            <!--[if lt IE 9]>
                <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
            <![endif]-->
        
        
            <!-- The Author meta propagates the byline in a number of social networks -->
<meta name="author" content="Aram Zucker-Scharff">

<meta property="og:title" content="XYZ Site - Day 9 - PostCSS Mods - Speed up the massive build time and decrease needed memory by limiting what CSS gets built.">

<meta property="og:description" content="Why can't I just designate files to process with PostCSS easily?">


<meta property="og:url" content="https://fightwithtools.dev/posts/projects/aramzsxyz/day-9-getting-pocket-working-speeding-up-build/">

<meta property="og:site_name" content="Fight With Tools: A Dev Blog">

<meta property="og:locale" content="en_US">

<meta name="twitter:site" content="@chronotope">

<meta name="twitter:description" content="Why can't I just designate files to process with PostCSS easily?">

<meta name="description" content="Why can't I just designate files to process with PostCSS easily?">

<!-- I prefer the summary_large_image Twitter card for posts. -->
<meta name="twitter:card" content="summary_large_image">
<!-- You, you're the creator. -->
<meta name="twitter:creator" content="@chronotope">
<!-- This property is for the article title, not site title. -->
<meta name="twitter:title" content="XYZ Site - Day 9 - PostCSS Mods - Speed up the massive build time and decrease needed memory by limiting what CSS gets built.">



<meta property="og:image" content="https://fightwithtools.dev/img/xyz-icon.png">
<meta name="twitter:image" content="https://fightwithtools.dev/img/xyz-icon.png">




    <!-- Article specific OG data -->
    <!-- The OG:Type dictates a number of other tags on posts. -->
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="Wed, 27 Nov 2024 21:59:43 GMT">

    <!-- page.modified isn't a natural Jekyll property, but it can be added. -->
    

    <!-- Here my author and publisher tags are the same (yay self-publishing) -->
    <meta property="article:author" content="http://facebook.com/aramzs">
    <!-- But if your site has its own page, this is where to put it. -->
    <meta property="article:publisher" content="https://www.facebook.com/aramzs">

    
    <!-- Article section isn't a required property, but it can be good to have -->
    <meta property="article:section" content="AramZS XYZ">
    

    
        <!-- I use the page.categories property for OG tags. -->
        
        <meta property="article:tag" content="posts">
        
        <meta property="article:tag" content="projects">
        
        <meta property="article:tag" content="11ty">
        
        <meta property="article:tag" content="Node">
        
        <meta property="article:tag" content="SSG">
        
        <meta property="article:tag" content="WiP">
        
        <meta property="article:tag" content="async">
        
        <meta property="article:tag" content="JSON">
        
        <meta property="article:tag" content="Pocket">
        
        <meta property="article:tag" content="pcss">
        
        <meta property="article:tag" content="PostCSS">
        
        <meta property="article:tag" content="CSS">
        
        <meta name="keywords" content="posts, projects, 11ty, Node, SSG, WiP, async, JSON, Pocket, pcss, PostCSS, CSS">
    



            <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Blog",
        "url": "https://fightwithtools.dev/posts/projects/aramzsxyz/day-9-getting-pocket-working-speeding-up-build/",
        "headline": "XYZ Site - Day 9 - PostCSS Mods - Speed up the massive build time and decrease needed memory by limiting what CSS gets built.",
        "about": "Why can't I just designate files to process with PostCSS easily?",
        "image": [
            "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
        ],
        "isAccessibleForFree": "True",
        "isPartOf": {
            "@type": ["CreativeWork", "Product"],
            "name": "Fight With Tools",
            "productID": "fightwithtools.dev"
        },
        "discussionUrl": "https://twitter.com/search?q=to%3AChronotope%20%23dev&src=typed_query&f=top",
        "author": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Lead Privacy Engineer at The Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": "https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg"
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
}, 
        "editor": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Lead Privacy Engineer at The Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": "https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg"
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
},
        "inLanguage": "en-US",
        "license": "http://creativecommons.org/licenses/by-sa/4.0/",
        "additionalType": "CreativeWork",
        "alternateName": "Fight With Tools Dev",
        "publisher": {
            "@type": "Organization",
            "name": "Fight With Tools",
            "description": "A site discussing how to imagine, build, analyze and use cool code and web tools. Better websites, better stories, better developers. Technology won't save the world, but you can.",
            "sameAs": "https://fightwithtools.dev/",
            "logo": {
                "@type": "ImageObject",
                "url": "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
            },
            "publishingPrinciples": "http://aramzs.github.io/about/"
        }
    }
</script>

        
        
        
<link rel="canonical" href="https://fightwithtools.dev/posts/projects/aramzsxyz/day-9-getting-pocket-working-speeding-up-build/">

        </head>
        <body itemscope="" itemtype="https://schema.org/Blog">
            <div class="wrapper">
                <header>
                    
                        
                            <div id="site-name-subhead">
                                <a href="https://fightwithtools.dev">Fight With Tools: A Dev Blog</a>
                                
                                    > <a id="project-link" href="https://fightwithtools.dev/projects/aramzsxyz">AramZS XYZ</a>
                                
                            </div>
                        
                        
                            <!-- post mode -->
                            <time>Wed Nov 27 2024</time>
                            <!-- front matter dates made in format at https://yaml.org/type/timestamp.html -->
                        
                        
                            <!-- projects mode -->
                        
                        <h1 class="header" id="xyz-site-day-9-postcss-mods-speed-up-the-massive-build-time-and-decrease-needed-memory-by-limiting-what-css-gets-built">
                            XYZ Site - Day 9 - PostCSS Mods - Speed up the massive build time and decrease needed memory by limiting what CSS gets built.
                        </h1>
                        
                        
                    
                    
    <h5 itemprop="author" itemscope="" itemtype="https://schema.org/Person" id="by-aram-zucker-scharff">
    <link itemprop="sameAs" href="http://aramzs.github.io/aramzs/">
    By <span itemprop="name"><a href="http://aramzs.github.io/aramzs/" target="_blank">Aram Zucker-Scharff</a></span>
</h5>

                </header>
                <main>
                    
    <section id="precontent">
        <aside id="toc-container">
            <div id="toc-container__inner">
                <h2 id="contents">Contents</h2>
                <nav class="toc">
        <ol><li><a href="#project-scope-and-todos">Project Scope and ToDos</a></li><li><a href="#day-9">Day 9</a></li></ol>
      </nav>
            </div>
        </aside>
        <div id="post-description">Why can't I just designate files to process with PostCSS easily?</div>

        

    </section>

                    <section id="maincontent" class="maincontent">
                    
                        <h2 id="project-scope-and-todos" tabindex="-1">Project Scope and ToDos</h2>
<ol>
<li>Create a versatile blog site</li>
<li>Create a framework that makes it easy to add external data to the site</li>
</ol>
<ul class="task-list">
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> Give the site the capacity to replicate the logging and rating I do on Serialized and Letterboxd.</li>
<li class="task-list-item"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Be able to pull down RSS feeds from other sites and create forward links to my other sites</li>
<li class="task-list-item"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Create forward links to sites I want to post about.</li>
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> Create a way to pull in my Goodreads data and display it on the site</li>
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> Create a way to automate pulls from other data sources</li>
<li class="task-list-item"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Combine easy inputs like text lists and JSON data files with markdown files that I can build on top of.</li>
<li class="task-list-item"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Add a TMDB credit to footer in base.njk</li>
<li class="task-list-item"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Make sure tags do not repeat in the displayed tag list.</li>
<li class="task-list-item"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Get my Kindle Quotes into the site</li>
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> YouTube Channel Recommendations</li>
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> Minify HTML via Netlify plugin.</li>
</ul>
<h2 id="day-9" tabindex="-1">Day 9</h2>
<p>I'm trying to speed up the build time. It turns out that this many files is causing the memory in my Netlify build is causing the process to use up too much memory. So a few hacks to get in place.</p>
<p><code>filter</code> is too expensive for arrays from everything I've read so I'm going to try and replace it with a <code>for</code> I pulled off a blogpost.</p>
<p class="skip-link-graf">
<a href="#code-skip-day-9-getting-pocket-working-speeding-up-build-6" id="skip-to-code-skip-day-9-getting-pocket-working-speeding-up-build-6" class="skip-link">Skip code block ▼</a></p>
<pre class="language-js"><code class="language-js"><br><span class="token comment">/**<br>@func util<br>a custom high-performance filter<br>via https://dev.to/functional_js/write-a-custom-javascript-filter-function-that-is-60-faster-than-array-filter-4b66<br>@perf<br>60% faster than the built-in JavaScript filter func<br>@typedef {(e: *) => boolean} filterFnAny<br>@param {filterFnAny} fn<br>@param {*[]} a<br>@return {*[]}<br>*/</span><br><span class="token keyword">const</span> <span class="token function-variable function">betterFilter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//final</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      f<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> f<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-day-9-getting-pocket-working-speeding-up-build-6">There are a few places the filters for Nunjucks are using that <code>filter</code>, so I'll replace them.</p>
<p>I can also exclude <code>amplify</code> contentType posts from a number of places where it is building big objects up. Discarding them and doing it early in those processes should mean the build will take up less memory and go faster.</p>
<p>This is helping drop some of the build time, but it is still expensive.</p>
<p>My last build gave me this info:</p>
<p class="skip-link-graf">
<a href="#code-skip-day-9-getting-pocket-working-speeding-up-build-5" id="skip-to-code-skip-day-9-getting-pocket-working-speeding-up-build-5" class="skip-link">Skip code block ▼</a></p>
<pre class="language-bash"><code class="language-bash"><span class="token punctuation">[</span>11ty<span class="token punctuation">]</span> Benchmark  16412ms  <span class="token number">15</span>% <span class="token number">12166</span>× <span class="token punctuation">(</span>Configuration<span class="token punctuation">)</span> <span class="token string">"excludeStubs"</span> Nunjucks Filter<br><span class="token punctuation">[</span>11ty<span class="token punctuation">]</span> Benchmark  35852ms  <span class="token number">33</span>% <span class="token number">36435</span>× <span class="token punctuation">(</span>Configuration<span class="token punctuation">)</span> <span class="token string">"countByKey"</span> Nunjucks Filter<br><span class="token punctuation">[</span>11ty<span class="token punctuation">]</span> Benchmark  13719ms  <span class="token number">13</span>% <span class="token number">12168</span>× <span class="token punctuation">(</span>Configuration<span class="token punctuation">)</span> <span class="token string">"identifyGlyphs"</span> Transform</code></pre>
<p id="code-skip-day-9-getting-pocket-working-speeding-up-build-5">Big build functions. Let's see if I can accelerate further.</p>
<p>I'm going to try and use <code>&quot;@11ty/eleventy-plugin-directory-output&quot;</code> to give me some ideas of where I can decrease CPU and memory usage as well.</p>
<p>I've managed to improve some of these, but they're still expensive, especially when run so many times. <code>countByKey</code> is part of the menu build, so especially expensive.</p>
<p data-wordfix="true">I also want to try and remove the HTML minify process to Netlify, but the plugin they have for that doesn't seem to work, probably because it is so out of date. I'm going to <a href="https://www.atlassian.com/git/tutorials/git-subtree" target="_blank">subtree</a> it in and run it internally.</p>
<p><a target="_blank" href="https://github.com/AramZS/aramzs.xyz/commit/db3ddef461615f0fd17343258a5892af871a41c0" class="git-commit-link"><code>git commit -am &quot;Moving html minification to a netlify function&quot;</code></a></p>
<p>Let's try and run this on Netlify to see if my switchover works!</p>
<p>Huh, apparently in order to run Netlify <a href="https://docs.netlify.com/build-plugins/" target="_blank">plugins</a> that are local to the project I need to add a plugin:</p>
<p class="skip-link-graf">
<a href="#code-skip-day-9-getting-pocket-working-speeding-up-build-4" id="skip-to-code-skip-day-9-getting-pocket-working-speeding-up-build-4" class="skip-link">Skip code block ▼</a></p>
<pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">[</span><span class="token punctuation">[</span>plugins<span class="token punctuation">]</span><span class="token punctuation">]</span><br>package = "@netlify/plugin<span class="token punctuation">-</span>local<span class="token punctuation">-</span>install<span class="token punctuation">-</span>core"</code></pre>
<p id="code-skip-day-9-getting-pocket-working-speeding-up-build-4">This gets it running, but it doesn't seem to actually minify the HTML, no matter <a href="http://perfectionkills.com/experimenting-with-html-minifier/" target="_blank">what options</a> I put in! Ugh. Maybe I'll leave that alone for now to fiddle with later. <a href="https://docs.netlify.com/cli/get-started/#run-builds-locally" target="_blank">Looks like there is info about how to test it here</a>.</p>
<p>I'm also looking at how to fix it so it isn't spending time building the sub-css files that are prefixed with <code>_</code>, which it seems to be doing.</p>
<p>Is there really no way to get postcss not to waste time on the included files? It seems very strange to me.</p>
<p data-wordfix="true">Ok, I looked around and <a href="https://github.com/11ty/eleventy/discussions/2388" target="_blank">found</a> a way that speeds things up significantly. I can add it <a href="https://www.11ty.dev/docs/languages/custom/" target="_blank">as a template format</a> and then manage it with an extension.</p>
<p>I can manage it in an extensions file.</p>
<p class="skip-link-graf">
<a href="#code-skip-day-9-getting-pocket-working-speeding-up-build-3" id="skip-to-code-skip-day-9-getting-pocket-working-speeding-up-build-3" class="skip-link">Skip code block ▼</a></p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cssHandler <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">outputFileExtension</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span><br>  <span class="token function-variable function">compile</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">inputContent<span class="token punctuation">,</span> inputPath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>inputPath <span class="token operator">!==</span> <span class="token string">'./src/styles/main.css'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> postcss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// https://github.com/postcss/postcss-load-config</span><br>      <span class="token keyword">const</span> postcssrc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-load-config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'postcssrc'</span><span class="token punctuation">,</span> postcssrc<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token comment">// https://github.com/11ty/eleventy/discussions/2388</span><br>      <span class="token keyword">let</span> cssPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>        <span class="token function">postcssrc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> plugins<span class="token punctuation">,</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pcss plugins'</span><span class="token punctuation">,</span> plugins<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          options<span class="token punctuation">.</span>from <span class="token operator">=</span> inputPath<span class="token punctuation">;</span><br>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pcss options'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token function">postcss</span><span class="token punctuation">(</span>plugins<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>inputContent<span class="token punctuation">,</span> options<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>              <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>css<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">const</span> cssResult <span class="token operator">=</span> <span class="token keyword">await</span> cssPromise<span class="token punctuation">;</span><br>      <span class="token comment">// console.log('cssResult', cssResult);</span><br>      <span class="token comment">// debugger;</span><br>      <span class="token keyword">return</span> cssResult<span class="token punctuation">;</span><br><br>      <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">[</span><br>        pimport<span class="token punctuation">,</span><br>        autoprefixer<span class="token punctuation">,</span><br>        csso<br>      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>inputContent<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">from</span><span class="token operator">:</span> inputPath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><br>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">css</span><span class="token operator">:</span> cssHandler<br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-day-9-getting-pocket-working-speeding-up-build-3">which I can then load like this in my eleventy config file:</p>
<p class="skip-link-graf">
<a href="#code-skip-day-9-getting-pocket-working-speeding-up-build-2" id="skip-to-code-skip-day-9-getting-pocket-working-speeding-up-build-2" class="skip-link">Skip code block ▼</a></p>
<pre class="language-js"><code class="language-js">  eleventyConfig<span class="token punctuation">.</span><span class="token function">addTemplateFormats</span><span class="token punctuation">(</span><span class="token string">'css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>extensions<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">extensionName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		eleventyConfig<span class="token punctuation">.</span><span class="token function">addExtension</span><span class="token punctuation">(</span>extensionName<span class="token punctuation">,</span> extensions<span class="token punctuation">[</span>extensionName<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-day-9-getting-pocket-working-speeding-up-build-2">I added the use of <code>'postcss-load-config'</code> here to let me manage postcss settings and plugins from a file at <code>postcss.config.js</code>.</p>
<p>In case you are wondering, the logging looks like this:</p>
<p class="skip-link-graf">
<a href="#code-skip-day-9-getting-pocket-working-speeding-up-build-1" id="skip-to-code-skip-day-9-getting-pocket-working-speeding-up-build-1" class="skip-link">Skip code block ▼</a></p>
<pre class="language-bash"><code class="language-bash">postcssrc <span class="token punctuation">[</span>Function: rc<span class="token punctuation">]</span><br>pcss plugins <span class="token punctuation">[</span><br>  <span class="token punctuation">[</span>Function: AtImport<span class="token punctuation">]</span> <span class="token punctuation">{</span> postcss: <span class="token boolean">true</span> <span class="token punctuation">}</span>,<br>  <span class="token punctuation">[</span>Function: plugin<span class="token punctuation">]</span> <span class="token punctuation">{</span><br>    postcss: true,<br>    data: <span class="token punctuation">{</span> browsers: <span class="token punctuation">[</span>Object<span class="token punctuation">]</span>, prefixes: <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">}</span>,<br>    defaults: <span class="token punctuation">[</span> <span class="token string">'> 0.5%'</span>, <span class="token string">'last 2 versions'</span>, <span class="token string">'Firefox ESR'</span>, <span class="token string">'not dead'</span> <span class="token punctuation">]</span>,<br>    info: <span class="token punctuation">[</span>Function <span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">]</span><br>  <span class="token punctuation">}</span>,<br>  <span class="token punctuation">{</span> postcssPlugin: <span class="token string">'postcss-purgecss'</span>, OnceExit: <span class="token punctuation">[</span>Function: OnceExit<span class="token punctuation">]</span> <span class="token punctuation">}</span>,<br>  <span class="token punctuation">[</span>Function <span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> postcss: <span class="token boolean">true</span> <span class="token punctuation">}</span><br><span class="token punctuation">]</span><br>pcss options <span class="token punctuation">{</span><br>  configLocation: <span class="token string">'./postcss.config.js'</span>,<br>  cwd: <span class="token string">'/Users/chrono/Dev/aramzs.xyz'</span>,<br>  env: undefined,<br>  from: <span class="token string">'./src/styles/main.css'</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-day-9-getting-pocket-working-speeding-up-build-1">Looks like the <code>options</code> we get out of that tool is just everything supplied in the export of the file that isn't on the <code>plugins</code> property.</p>
<p>Ok, that works <em>much</em> faster. Mostly because it only has to process the <code>main.css</code> file and not build the others.</p>
<p><a target="_blank" href="https://github.com/AramZS/aramzs.xyz/commit/ecb89ef623364d01a3037b7dea80fabae6fb7496" class="git-commit-link"><code>git commit -am &quot;Move postcss processing internal to the template format flow of eleventy&quot;</code></a></p>
<p>I can also remove invocations of my most expensive functions from the pages that forward users where the users will never see the menu that triggers them.</p>
<p><a target="_blank" href="https://github.com/AramZS/aramzs.xyz/commit/2e70c355994d671dd3198c31e4ac35c7756e851e" class="git-commit-link"><code>git commit -am &quot;Remove the invocations of the counting function from pages that no user is likely to see because they mostly are forwarding people&quot;</code></a></p>

                    
                    </section>
                    <section id="postcontent">
                    
    <script src="https://utteranc.es/client.js" repo="AramZS/fightwithtools-comments" issue-term="title" theme="github-dark" crossorigin="anonymous" async="">
    </script>
    
        
        
        <div class="pagination">
            <a href="/posts/projects/aramzsxyz/day-8-getting-pocket-working-processing-to-flat-file-part-3/" class="pagination-link cursor-pointer ">Previous Day</a>

            <a href="/posts/projects/aramzsxyz/day-10-getting-pocket-working-post-build-netlify-processing/" class="pagination-link cursor-pointer ">Next Day</a>
        </div>
    
    <div class="social-icons-block">
    <div class="a-social-icon">
        <a href="https://github.com/AramZS/" target="_blank">
            <svg role="img" viewBox="0 0 24 24" class="twitter-icon social-icon" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>


<!-- https://simpleicons.org/?q=github -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://bit.ly/aramzs" target="_blank">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg>


<!-- https://simpleicons.org/?q=linked -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://twitter.com/Chronotope" target="_blank">
            <svg role="img" class="twitter-icon social-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg>

<!-- https://simpleicons.org/?q=tw -->

        </a>
    </div>
    
    <div class="a-social-icon">
        <a href="https://indieweb.social/@Chronotope" rel="me" target="_blank">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.193 7.88c0-5.207-3.411-6.733-3.411-6.733C18.062.357 15.108.025 12.041 0h-.076c-3.069.025-6.02.357-7.74 1.147 0 0-3.412 1.526-3.412 6.732 0 1.193-.023 2.619.015 4.13.124 5.092.934 10.11 5.641 11.355 2.17.574 4.034.695 5.536.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.13.54c-2.165-.075-4.449-.234-4.799-2.892a5.5 5.5 0 0 1-.048-.745s2.125.52 4.818.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.508.475-6.508zm-4.024 6.709h-2.497v-6.12c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.313v3.349h-2.484v-3.35c0-1.537-.602-2.313-1.802-2.313-1.085 0-1.628.655-1.628 1.945v6.119H4.831V8.285c0-1.29.328-2.314.987-3.07.68-.759 1.57-1.147 2.674-1.147 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.305z"></path></svg>

<!-- https://simpleicons.org/?q=mastodon -->

        </a>
    </div>

</div>


                    </section>
                </main>
                <footer>
                    
    <div id="taglist">
        <h6 id="tags">Tags: </h6>
        <ul><li>
                    <a href="https://fightwithtools.dev/tag/projects">projects</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/11ty">11ty</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/node">Node</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/ssg">SSG</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/wip">WiP</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/async">async</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/json">JSON</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/pocket">Pocket</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/pcss">pcss</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/postcss">PostCSS</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/css">CSS</a>
                </li></ul>
    </div>

                    
                        <p>
                            <small>Hosted on <a href="https://pages.github.com" target="_blank">GitHub Pages</a> based on <a href="https://github.com/pages-themes/dinky" target="_blank">the Dinky theme</a>. <a href="https://github.com/AramZS/devblog" target="_blank">See the code</a>.</small>
                        </p>
                    
                    
                </footer>
            </div>
            <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        </body>
    </html>
