<!doctype html>
    <html lang="en-US" id="template-post" class="base">
        <head>
        <script defer data-domain="fightwithtools.dev" src="https://plausible.io/js/plausible.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Fight With Tools: A Dev Blog RSS" href="https://fightwithtools.dev/rss/" />
    	<link rel="alternate" type="application/atom+xml" title="Fight With Tools: A Dev Blog Feed" href="https://fightwithtools.dev/feed/" />
        
            <!-- Sub Template: post -->
        
        
            <meta charset="utf-8" />
            <meta http-equiv="X-UA-Compatible" content="IE=edge" />
            <title>Part 37:  Markdown It, Caching and Automatic Commit Links</title>
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="preload" as="style" />
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="stylesheet" />
            <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=1713803648" /> -->
            <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=1713803648" id=""></link>

            
                <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=1713803648" /> -->
                <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=1713803648" id=""></link>

            
            <!-- Build Revision: 1713803648 & Sha: a806cfe7a46030e82c75efed2ced810ea553973b -->
            <script src="https://fightwithtools.dev/assets/js/scale.fix.js"></script>
            <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
            <!--[if lt IE 9]>
                <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
            <![endif]-->
        
        
            <!-- The Author meta propagates the byline in a number of social networks -->
<meta name="author" content="Aram Zucker-Scharff" />

<meta property="og:title"
    content="Part 37: Markdown It, Caching and Automatic Commit Links">

<meta property="og:description"
    content="More devblog">


<meta property="og:url"
    content="https://fightwithtools.dev/posts/projects/devblog/hello-day-37/" />

<meta property="og:site_name" content="Fight With Tools: A Dev Blog" />

<meta property="og:locale" content="en_US" />

<meta name="twitter:site" content="@chronotope" />

<meta name="twitter:description" content="More devblog" />

<!-- I prefer the summary_large_image Twitter card for posts. -->
<meta name="twitter:card" content="summary_large_image" />
<!-- You, you're the creator. -->
<meta name="twitter:creator" content="@chronotope" />
<!-- This property is for the article title, not site title. -->
<meta name="twitter:title" content="Part 37: Markdown It, Caching and Automatic Commit Links" />



<meta property="og:image" content="https://fightwithtools.dev/img/close-up-keys.jpg" />
<meta name="twitter:image" content="https://fightwithtools.dev/img/close-up-keys.jpg" />




    <!-- Article specific OG data -->
    <!-- The OG:Type dictates a number of other tags on posts. -->
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="Thu, 18 Nov 2021 02:59:43 GMT" />

    <!-- page.modified isn't a natural Jekyll property, but it can be added. -->
    

    <!-- Here my author and publisher tags are the same (yay self-publishing) -->
    <meta property="article:author" content="http://facebook.com/aramzs" />
    <!-- But if your site has its own page, this is where to put it. -->
    <meta property="article:publisher" content="https://www.facebook.com/aramzs" />

    
    <!-- Article section isn't a required property, but it can be good to have -->
    <meta property="article:section" content="Dev Blog" />
    

    <!-- I use the page.categories property for OG tags. -->
    
    <meta property="article:tag" content="posts" />
    
    <meta property="article:tag" content="projects" />
    
    <meta property="article:tag" content="Starters" />
    
    <meta property="article:tag" content="11ty" />
    
    <meta property="article:tag" content="Node" />
    
    <meta property="article:tag" content="WiP" />
    
    <meta property="article:tag" content="Markdown-It" />
    



            <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Blog",
        "url": "https://fightwithtools.dev/posts/projects/devblog/hello-day-37/",
        "headline": "Part 37:  Markdown It, Caching and Automatic Commit Links",
        "about": "More devblog",
        "image": [
            "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
        ],
        "isAccessibleForFree": "True",
        "isPartOf": {
            "@type": ["CreativeWork", "Product"],
            "name": "Fight With Tools",
            "productID": "aramzs.github.io"
        },
        "discussionUrl": "https://twitter.com/search?q=to%3AChronotope%20%23dev&src=typed_query&f=top",
        "author": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Director for Ad Engineering at Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
}, 
        "editor": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Director for Ad Engineering at Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
},
        "inLanguage": "en-US",
        "license": "http://creativecommons.org/licenses/by-sa/4.0/",
        "additionalType": "CreativeWork",
        "alternateName": "Fight With Tools Dev",
        "publisher": {
            "@type": "Organization",
            "name": "Fight With Tools",
            "description": "A site discussing how to imagine, build, analyze and use cool code and web tools. Better websites, better stories, better developers. Technology won't save the world, but you can.",
            "sameAs": "http://aramzs.github.io",
            "logo": {
                "@type": "ImageObject",
                "url": "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
            },
            "publishingPrinciples": "http://aramzs.github.io/about/"
        }
    }
</script>

        
        
        </head>
        <body itemscope itemtype="https://schema.org/Blog">
            <div class="wrapper">
                <header>
                    
                        
                            <div id="site-name-subhead">
                                <a href="https://fightwithtools.dev">Fight With Tools: A Dev Blog</a>
                                
                                    > <a id="project-link" href="https://fightwithtools.dev/projects/devblog">Dev Blog</a>
                                
                            </div>
                        
                        
                            <!-- post mode -->
                            <time>Thu Nov 18 2021</time>
                            <!-- front matter dates made in format at https://yaml.org/type/timestamp.html -->
                        
                        
                            <!-- projects mode -->
                        
                        <h1 class="header">
                            Part 37:  Markdown It, Caching and Automatic Commit Links
                        </h1>
                        
                        
                    
                    
    <h5 itemprop="author" itemscope itemtype="https://schema.org/Person">
    <link itemprop="sameAs" href="http://aramzs.github.io/aramzs/" />
    By <span itemprop="name">Aram Zucker-Scharff</span>
</h5>

                </header>
                <main>
                    
    <section id="precontent">
        <aside id="toc-container">
            <div id="toc-container__inner">
                <h2>Contents</h2>
                <nav class="toc">
        <ol><li><a href="#project-scope-and-todos">Project Scope and ToDos</a></li><li><a href="#day-37">Day 37</a><ol><li><a href="#finding-the-inline-token">Finding the inline token</a></li><li><a href="#markdown-it-state-obj">Markdown-it State Obj</a></li><li><a href="#searching-for-git-commit-via-api">Searching for git commit via API</a></li><li><a href="#caching-commit-links">Caching Commit Links</a></li><li><a href="#rendering-link-with-markdown-it">Rendering link with Markdown It</a></li><li><a href="#adding-link-css">Adding Link CSS</a></li><li><a href="#touch-up-of-markdown-it-link-process">Touch Up of Markdown It Link Process</a><ol><li><a href="#push-to-end-of-core-rules">Push to end of core rules</a></li><li><a href="#create-link-tokens">Create link tokens</a></li><li><a href="#can't-start-secrets-with-github">Can't start secrets with GITHUB</a></li></ol></li></ol></li></ol></nav>
            </div>
        </aside>
        <div id="post-description">More devblog</div>

        
    <figure class="figure preview-image">
        <img src="https://fightwithtools.dev/img/close-up-keys.jpg" alt="Close up photo of keyboard keys.">
        
            <figcaption class="figcaption">
                
                 | <em>
                        <a href="https://www.flickr.com/photos/40393390@N00/2386752252" target="_blank">'TYPE' by SarahDeer is licensed with CC BY 2.0</a>
                    </em> | 
            </figcaption>
        
    </figure>


    </section>

                    <section id="maincontent" class="maincontent">
                    
                        <h2 id="project-scope-and-todos" tabindex="-1">Project Scope and ToDos</h2>
<ol>
<li>Static Site Generator that can build the blog and let me host it on Github Pages</li>
<li>I want to write posts in Markdown because I'm lazy, it's easy, and it is how I take notes now.</li>
<li>I don't want to spend a ton of time doing design work. I'm doing complicated designs for other projects, so I want to pull a theme I like that I can rely on someone else to keep up.</li>
<li>Once it gets going, I want template changes to be easy.</li>
<li>It should be as easy as Jekyll, so I need to be able to build it using GitHub Actions, where I can just commit a template change or Markdown file and away it goes. If I can't figure this out than fk it, just use Jekyll.</li>
<li>I require it to be used by a significant percent of my professional peers so I can get easy answers when something goes wrong.</li>
<li>I want source maps. This is a dev log site which means whatever I do with it should be easy for other developers to read.</li>
</ol>
<ul class="task-list">
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Also <a href="https://www.npmjs.com/package/@quasibit/eleventy-plugin-sitemap" target="_blank">the sitemap plugin</a> looks cool. Should grab that later.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" class="markdown-todo"></input> So does the <a href="https://www.npmjs.com/package/eleventy-plugin-reading-time" target="_blank">reading time one</a>.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Also <a href="https://github.com/jdsteinbach/eleventy-plugin-toc/" target="_blank">this TOC plugin</a> mby?</p>
</li>
<li class="task-list-item">
<p data-wordfix="true"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Use <a href="https://www.11ty.dev/docs/data-deep-merge/" target="_blank">Data Deep Merge</a> in this blog.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Decide if I want to render the CSS fancier than just a base file and do per-template splitting.</p>
</li>
</ul>
<s>
<ul class="task-list">
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"></input> Can I use the template inside of dinky that already exists instead of copy/pasting it?</li>
</ul>
</s>
<s>
<ul class="task-list">
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"></input> Is there a way to have permalinks to posts contain metadata without organizing them into subfolders?</li>
</ul>
</s>
<ul class="task-list">
<li class="task-list-item">
<p data-wordfix="true"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> How do I cachebreak files on the basis of new build events? Datetime? <code>site.github.build_revision</code> is <a href="https://github.com/jekyll/github-metadata/blob/master/docs/site.github.md" target="_blank">how Jekyll accomplishes this</a>, but is there a way to push <a href="https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context" target="_blank">that</a> <a href="https://stackoverflow.com/questions/54310050/how-to-version-build-artifacts-using-github-actions" target="_blank">into the build process</a> for Eleventy?</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Make link text look less shitty. It looks like it is a whole, lighter, font.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Code blocks do not have good syntax highlighting. I want good syntax highlighting.</p>
</li>
<li class="task-list-item">
<p data-wordfix="true"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Build a Markdown-it plugin to take my typing shortcuts <code>[prob, b/c, ...?]</code> and expand them on build.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" class="markdown-todo"></input> See if we can start Markdown's interpretation of H tags to <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements#multiple_h1" target="_blank">start at 2, since H1</a> is always pulled from the page title metadata. If it isn't easy, I just have to change my pattern of writing in the MD documents.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Should I <a href="https://www.madebymike.com.au/writing/11ty-filters-data-shortcodes/" target="_blank">explore some shortcodes</a>?</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Order projects listing by last posted blog in that project</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Limit the output of home page post lists to a specific number of posts</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Show the latest post below the site intro on the homepage.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Tags pages with Pagination</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Posts should be able to support a preview header image that can also be shown on post lists.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" class="markdown-todo"></input> Create a Markdown-It plugin that reads the project's repo URL off the folder data file and renders commit messages with <a href="https://stackoverflow.com/questions/15919635/on-github-api-what-is-the-best-way-to-get-the-last-commit-message-associated-w" target="_blank">links to the referenced commit</a>. (Is this even possible?) (Is there a way to do it with eleventy instead?)</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Create Next Day/Previous Day links on each post / Next/Previous post on post templates from projects</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Tags should be in the sidebar of articles and link to tag pages</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Create a skiplink for the todo section (or would this be better served with the ToC plugin?) - Yes it would be!</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Add a Things I Learned section to the project pages that are the things I learned from that specific project.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Add a technical reading log to the homepage</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:empty" target="_blank">Hide</a> empty sections.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Add byline to post pages</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Have table of contents attach to sidebar bottom on mobile</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Support dark mode</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> Social Icons</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"></input> SEO/Social/JSON-LD HEAD data</p>
</li>
</ul>
<h2 id="day-37" tabindex="-1">Day 37</h2>
<p>Ok,so I need to apply the rules properly.</p>
<p>First, let's see what rules exist:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-16" id="skip-to-code-skip-hello-day-37-16" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>md<span class="token punctuation">.</span>core<span class="token punctuation">.</span>ruler<span class="token punctuation">)</span></code></pre>
<p id="code-skip-hello-day-37-16">Ok:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-15" id="skip-to-code-skip-hello-day-37-15" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript">Ruler <span class="token punctuation">{</span><br>  __rules__<span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'normalize'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> normalize<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'block'</span><span class="token punctuation">,</span> enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> fn<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> block<span class="token punctuation">]</span><span class="token punctuation">,</span> alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'inline'</span><span class="token punctuation">,</span> enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> fn<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> inline<span class="token punctuation">]</span><span class="token punctuation">,</span> alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'short-phrase-fixer'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Function</span> <span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'evernote-todo'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Function</span> <span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'replace-link'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Function</span> <span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'linkify'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> linkify<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'replacements'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> replace<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'smartquotes'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> smartquotes<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'anchor'</span><span class="token punctuation">,</span><br>      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      fn<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Function</span> <span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      alt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  __cache__<span class="token operator">:</span> <span class="token keyword">null</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="finding-the-inline-token" tabindex="-1">Finding the inline token</h3>
<p id="code-skip-hello-day-37-15">Ok, so I need to set up a token type starting with inline. Let's try and match the right token:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-14" id="skip-to-code-skip-hello-day-37-14" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> testPattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;=git commit \-am [\"|\'])(.*)(?=[\"|\'])</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">;</span><br><br><span class="token comment">// console.dir(md.core.ruler)</span><br>md<span class="token punctuation">.</span>core<span class="token punctuation">.</span>ruler<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">'inline'</span><span class="token punctuation">,</span> <span class="token string">'git_commit'</span><span class="token punctuation">,</span> <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> tokens <span class="token operator">=</span> state<span class="token punctuation">.</span>tokens<br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  	<span class="token keyword">if</span> <span class="token punctuation">(</span>testPattern<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'tokens round 1: '</span><span class="token punctuation">,</span> tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><br>  	<span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p id="code-skip-hello-day-37-14">Results:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-13" id="skip-to-code-skip-hello-day-37-13" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"> Token <span class="token punctuation">{</span><br>  type<span class="token operator">:</span> <span class="token string">'inline'</span><span class="token punctuation">,</span><br>  tag<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>  attrs<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  map<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">143</span><span class="token punctuation">,</span> <span class="token number">144</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  nesting<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  level<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  children<span class="token operator">:</span> <span class="token punctuation">[</span><br>    Token <span class="token punctuation">{</span><br>      type<span class="token operator">:</span> <span class="token string">'code_inline'</span><span class="token punctuation">,</span><br>      tag<span class="token operator">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span><br>      attrs<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      map<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      nesting<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>      level<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>      children<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      content<span class="token operator">:</span> <span class="token string">'git commit -am "Get macros in the mix."'</span><span class="token punctuation">,</span><br>      markup<span class="token operator">:</span> <span class="token string">'`'</span><span class="token punctuation">,</span><br>      info<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>      meta<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      block<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      hidden<span class="token operator">:</span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  content<span class="token operator">:</span> <span class="token string">'`git commit -am "Get macros in the mix."`'</span><span class="token punctuation">,</span><br>  markup<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>  info<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>  meta<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  block<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  hidden<span class="token operator">:</span> <span class="token boolean">false</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="markdown-it-state-obj" tabindex="-1">Markdown-it State Obj</h3>
<p id="code-skip-hello-day-37-13">Good to know, ok, what is in this state object anyway?</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-12" id="skip-to-code-skip-hello-day-37-12" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript">StateCore <span class="token punctuation">{</span><br>  src<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>  env<span class="token operator">:</span> <span class="token punctuation">{</span><br>    defaults<span class="token operator">:</span> <span class="token punctuation">{</span> layout<span class="token operator">:</span> <span class="token string">'default.njk'</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">'Talking about code'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    description<span class="token operator">:</span> <span class="token string">'Posts tagged with Markdown-It'</span><span class="token punctuation">,</span><br>    layout<span class="token operator">:</span> <span class="token string">'tags'</span><span class="token punctuation">,</span><br>    projects<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    site<span class="token operator">:</span> <span class="token punctuation">{</span><br>      lang<span class="token operator">:</span> <span class="token string">'en-US'</span><span class="token punctuation">,</span><br>      github<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      site_url<span class="token operator">:</span> <span class="token string">'http://localhost:8080'</span><span class="token punctuation">,</span><br>      site_name<span class="token operator">:</span> <span class="token string">'Fight With Tools: A Dev Blog'</span><span class="token punctuation">,</span><br>      description<span class="token operator">:</span> <span class="token string">'A site opening up my development process to all.'</span><span class="token punctuation">,</span><br>      featuredImage<span class="token operator">:</span> <span class="token string">'nyc_noir.jpg'</span><span class="token punctuation">,</span><br>      aramPhoto<span class="token operator">:</span> <span class="token string">'https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    pkg<span class="token operator">:</span> <span class="token punctuation">{</span><br>      name<span class="token operator">:</span> <span class="token string">'fightwithtooldev'</span><span class="token punctuation">,</span><br>      version<span class="token operator">:</span> <span class="token string">'1.0.0'</span><span class="token punctuation">,</span><br>      description<span class="token operator">:</span> <span class="token string">"This is the repo for Aram ZS's developer notes and log, keeping track of code experiments and decisions."</span><span class="token punctuation">,</span><br>      main<span class="token operator">:</span> <span class="token string">'index.js'</span><span class="token punctuation">,</span><br>      scripts<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      keywords<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      author<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>      license<span class="token operator">:</span> <span class="token string">'ISC'</span><span class="token punctuation">,</span><br>      devDependencies<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      dependencies<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    templateName<span class="token operator">:</span> <span class="token string">'tag'</span><span class="token punctuation">,</span><br>    eleventyExcludeFromCollections<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    pagination<span class="token operator">:</span> <span class="token punctuation">{</span><br>      data<span class="token operator">:</span> <span class="token string">'collections.deepTagList'</span><span class="token punctuation">,</span><br>      size<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      alias<span class="token operator">:</span> <span class="token string">'paged'</span><span class="token punctuation">,</span><br>      pages<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      page<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      items<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      pageNumber<span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span><br>      previousPageLink<span class="token operator">:</span> <span class="token string">'/tag/smo/index.html'</span><span class="token punctuation">,</span><br>      previous<span class="token operator">:</span> <span class="token string">'/tag/smo/index.html'</span><span class="token punctuation">,</span><br>      nextPageLink<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      next<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      firstPageLink<span class="token operator">:</span> <span class="token string">'/tag/blogroll/index.html'</span><span class="token punctuation">,</span><br>      lastPageLink<span class="token operator">:</span> <span class="token string">'/tag/markdown-it/index.html'</span><span class="token punctuation">,</span><br>      links<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      pageLinks<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      previousPageHref<span class="token operator">:</span> <span class="token string">'/tag/smo/'</span><span class="token punctuation">,</span><br>      nextPageHref<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      firstPageHref<span class="token operator">:</span> <span class="token string">'/tag/blogroll/'</span><span class="token punctuation">,</span><br>      lastPageHref<span class="token operator">:</span> <span class="token string">'/tag/markdown-it/'</span><span class="token punctuation">,</span><br>      hrefs<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      href<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    permalink<span class="token operator">:</span> <span class="token string">'tag/{{ paged.tagName | slug }}/{% if paged.number > 1 %}{{ paged.number }}/{% endif %}index.html'</span><span class="token punctuation">,</span><br>    eleventyComputed<span class="token operator">:</span> <span class="token punctuation">{</span><br>      title<span class="token operator">:</span> <span class="token string">'Tag: {{ paged.tagName }}{% if paged.number > 1 %} | Page {{paged.number}}{% endif %}'</span><span class="token punctuation">,</span><br>      description<span class="token operator">:</span> <span class="token string">'Posts tagged with {{ paged.tagName }}'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    page<span class="token operator">:</span> <span class="token punctuation">{</span><br>      date<span class="token operator">:</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">13</span>T22<span class="token operator">:</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">01.651</span>Z<span class="token punctuation">,</span><br>      inputPath<span class="token operator">:</span> <span class="token string">'./src/tags-pages.md'</span><span class="token punctuation">,</span><br>      fileSlug<span class="token operator">:</span> <span class="token string">'tags-pages'</span><span class="token punctuation">,</span><br>      filePathStem<span class="token operator">:</span> <span class="token string">'/tags-pages'</span><span class="token punctuation">,</span><br>      url<span class="token operator">:</span> <span class="token string">'/tag/markdown-it/'</span><span class="token punctuation">,</span><br>      outputPath<span class="token operator">:</span> <span class="token string">'docs/tag/markdown-it/index.html'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    paged<span class="token operator">:</span> <span class="token punctuation">{</span><br>      tagName<span class="token operator">:</span> <span class="token string">'Markdown-It'</span><span class="token punctuation">,</span><br>      number<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>      posts<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      first<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      last<span class="token operator">:</span> <span class="token boolean">true</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    title<span class="token operator">:</span> <span class="token string">'Tag: Markdown-It'</span><span class="token punctuation">,</span><br>    collections<span class="token operator">:</span> <span class="token punctuation">{</span><br>      all<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      blogroll<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'Personal Blog'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      links<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'Tech Critical'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      Blockchain<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      Cryptocurrency<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'Code Reference'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'Ad Tech'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'BAd Tech'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'Broken By Design'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      posts<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      projects<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      Starters<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'11ty'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      Node<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      Sass<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      WiP<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'Github Actions'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token constant">GPC</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token constant">CSS</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      Aggregation<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token constant">SEO</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token constant">SMO</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token string">'Markdown-It'</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      tagList<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      deepTagList<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  tokens<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  inlineMode<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>  md<span class="token operator">:</span> MarkdownIt <span class="token punctuation">{</span><br>    inline<span class="token operator">:</span> ParserInline <span class="token punctuation">{</span> ruler<span class="token operator">:</span> <span class="token punctuation">[</span>Ruler<span class="token punctuation">]</span><span class="token punctuation">,</span> ruler2<span class="token operator">:</span> <span class="token punctuation">[</span>Ruler<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    block<span class="token operator">:</span> ParserBlock <span class="token punctuation">{</span> ruler<span class="token operator">:</span> <span class="token punctuation">[</span>Ruler<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    core<span class="token operator">:</span> Core <span class="token punctuation">{</span> ruler<span class="token operator">:</span> <span class="token punctuation">[</span>Ruler<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    renderer<span class="token operator">:</span> Renderer <span class="token punctuation">{</span> rules<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    linkify<span class="token operator">:</span> LinkifyIt <span class="token punctuation">{</span><br>      __opts__<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      __index__<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><br>      __last_index__<span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span><br>      __schema__<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>      __text_cache__<span class="token operator">:</span> <span class="token string">'Especially with the variable name in the '</span><span class="token punctuation">,</span><br>      __schemas__<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      __compiled__<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      __tlds__<span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      __tlds_replaced__<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      re<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    validateLink<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> validateLink<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    normalizeLink<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> normalizeLink<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    normalizeLinkText<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> normalizeLinkText<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    utils<span class="token operator">:</span> <span class="token punctuation">{</span><br>      lib<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      assign<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> assign<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      isString<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> isString<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      has<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> has<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      unescapeMd<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> unescapeMd<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      unescapeAll<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> unescapeAll<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      isValidEntityCode<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> isValidEntityCode<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      fromCodePoint<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> fromCodePoint<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      escapeHtml<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> escapeHtml<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      arrayReplaceAt<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> arrayReplaceAt<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      isSpace<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> isSpace<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      isWhiteSpace<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> isWhiteSpace<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      isMdAsciiPunct<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> isMdAsciiPunct<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      isPunctChar<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> isPunctChar<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      escapeRE<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> escapeRE<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      normalizeReference<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> normalizeReference<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    helpers<span class="token operator">:</span> <span class="token punctuation">{</span><br>      parseLinkLabel<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> parseLinkLabel<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      parseLinkDestination<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> parseLinkDestination<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      parseLinkTitle<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> parseLinkTitle<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    options<span class="token operator">:</span> <span class="token punctuation">{</span><br>      html<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      xhtmlOut<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      breaks<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      langPrefix<span class="token operator">:</span> <span class="token string">'language-'</span><span class="token punctuation">,</span><br>      linkify<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      typographer<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      quotes<span class="token operator">:</span> <span class="token string">'“”‘’'</span><span class="token punctuation">,</span><br>      highlight<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Function</span> <span class="token punctuation">(</span>anonymous<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>      maxNesting<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>      replaceLink<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> replaceLink<span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-37-12">Oh, look at that. Everything I need to handle it at the rule level, instead of the <code>rerender</code> process!</p>
<p>Ok, so now I can make a plugin pretty similar to the one I did before.</p>
<h3 id="searching-for-git-commit-via-api" tabindex="-1">Searching for git commit via API</h3>
<p>I can find the commit message by searching through <code>inline</code> tokens, and pull the repo out of <code>state.env.repo</code>. I can then pull the commit message out of the inline token's <code>content</code> and use it with Octokit to search for the repo. The API query results in a <code>data</code> object with an <code>items</code> property that returns an array that looks like:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-11" id="skip-to-code-skip-hello-day-37-11" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><br>  <span class="token punctuation">{</span><br>    url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/commits/29ae79850439397742e0b7147a0fd9b5683058a4'</span><span class="token punctuation">,</span><br>    sha<span class="token operator">:</span> <span class="token string">'29ae79850439397742e0b7147a0fd9b5683058a4'</span><span class="token punctuation">,</span><br>    node_id<span class="token operator">:</span> <span class="token string">'MDY6Q29tbWl0Mzc2NzA2MzI2OjI5YWU3OTg1MDQzOTM5Nzc0MmUwYjcxNDdhMGZkOWI1NjgzMDU4YTQ='</span><span class="token punctuation">,</span><br>    html_url<span class="token operator">:</span> <span class="token string">'https://github.com/AramZS/devblog/commit/29ae79850439397742e0b7147a0fd9b5683058a4'</span><span class="token punctuation">,</span><br>    comments_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/commits/29ae79850439397742e0b7147a0fd9b5683058a4/comments'</span><span class="token punctuation">,</span><br>    commit<span class="token operator">:</span> <span class="token punctuation">{</span><br>      url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/git/commits/29ae79850439397742e0b7147a0fd9b5683058a4'</span><span class="token punctuation">,</span><br>      author<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      committer<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      message<span class="token operator">:</span> <span class="token string">'Set up blogroll and links and write up day 26'</span><span class="token punctuation">,</span><br>      tree<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      comment_count<span class="token operator">:</span> <span class="token number">0</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    author<span class="token operator">:</span> <span class="token punctuation">{</span><br>      login<span class="token operator">:</span> <span class="token string">'AramZS'</span><span class="token punctuation">,</span><br>      id<span class="token operator">:</span> <span class="token number">748069</span><span class="token punctuation">,</span><br>      node_id<span class="token operator">:</span> <span class="token string">'MDQ6VXNlcjc0ODA2OQ=='</span><span class="token punctuation">,</span><br>      avatar_url<span class="token operator">:</span> <span class="token string">'https://avatars.githubusercontent.com/u/748069?v=4'</span><span class="token punctuation">,</span><br>      gravatar_id<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>      url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS'</span><span class="token punctuation">,</span><br>      html_url<span class="token operator">:</span> <span class="token string">'https://github.com/AramZS'</span><span class="token punctuation">,</span><br>      followers_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/followers'</span><span class="token punctuation">,</span><br>      following_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/following{/other_user}'</span><span class="token punctuation">,</span><br>      gists_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/gists{/gist_id}'</span><span class="token punctuation">,</span><br>      starred_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/starred{/owner}{/repo}'</span><span class="token punctuation">,</span><br>      subscriptions_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/subscriptions'</span><span class="token punctuation">,</span><br>      organizations_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/orgs'</span><span class="token punctuation">,</span><br>      repos_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/repos'</span><span class="token punctuation">,</span><br>      events_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/events{/privacy}'</span><span class="token punctuation">,</span><br>      received_events_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/received_events'</span><span class="token punctuation">,</span><br>      type<span class="token operator">:</span> <span class="token string">'User'</span><span class="token punctuation">,</span><br>      site_admin<span class="token operator">:</span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    committer<span class="token operator">:</span> <span class="token punctuation">{</span><br>      login<span class="token operator">:</span> <span class="token string">'AramZS'</span><span class="token punctuation">,</span><br>      id<span class="token operator">:</span> <span class="token number">748069</span><span class="token punctuation">,</span><br>      node_id<span class="token operator">:</span> <span class="token string">'MDQ6VXNlcjc0ODA2OQ=='</span><span class="token punctuation">,</span><br>      avatar_url<span class="token operator">:</span> <span class="token string">'https://avatars.githubusercontent.com/u/748069?v=4'</span><span class="token punctuation">,</span><br>      gravatar_id<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>      url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS'</span><span class="token punctuation">,</span><br>      html_url<span class="token operator">:</span> <span class="token string">'https://github.com/AramZS'</span><span class="token punctuation">,</span><br>      followers_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/followers'</span><span class="token punctuation">,</span><br>      following_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/following{/other_user}'</span><span class="token punctuation">,</span><br>      gists_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/gists{/gist_id}'</span><span class="token punctuation">,</span><br>      starred_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/starred{/owner}{/repo}'</span><span class="token punctuation">,</span><br>      subscriptions_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/subscriptions'</span><span class="token punctuation">,</span><br>      organizations_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/orgs'</span><span class="token punctuation">,</span><br>      repos_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/repos'</span><span class="token punctuation">,</span><br>      events_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/events{/privacy}'</span><span class="token punctuation">,</span><br>      received_events_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/users/AramZS/received_events'</span><span class="token punctuation">,</span><br>      type<span class="token operator">:</span> <span class="token string">'User'</span><span class="token punctuation">,</span><br>      site_admin<span class="token operator">:</span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    parents<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>    repository<span class="token operator">:</span> <span class="token punctuation">{</span><br>      id<span class="token operator">:</span> <span class="token number">376706326</span><span class="token punctuation">,</span><br>      node_id<span class="token operator">:</span> <span class="token string">'MDEwOlJlcG9zaXRvcnkzNzY3MDYzMjY='</span><span class="token punctuation">,</span><br>      name<span class="token operator">:</span> <span class="token string">'devblog'</span><span class="token punctuation">,</span><br>      full_name<span class="token operator">:</span> <span class="token string">'AramZS/devblog'</span><span class="token punctuation">,</span><br>      <span class="token keyword">private</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      owner<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      html_url<span class="token operator">:</span> <span class="token string">'https://github.com/AramZS/devblog'</span><span class="token punctuation">,</span><br>      description<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      fork<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog'</span><span class="token punctuation">,</span><br>      forks_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/forks'</span><span class="token punctuation">,</span><br>      keys_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/keys{/key_id}'</span><span class="token punctuation">,</span><br>      collaborators_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/collaborators{/collaborator}'</span><span class="token punctuation">,</span><br>      teams_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/teams'</span><span class="token punctuation">,</span><br>      hooks_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/hooks'</span><span class="token punctuation">,</span><br>      issue_events_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/issues/events{/number}'</span><span class="token punctuation">,</span><br>      events_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/events'</span><span class="token punctuation">,</span><br>      assignees_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/assignees{/user}'</span><span class="token punctuation">,</span><br>      branches_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/branches{/branch}'</span><span class="token punctuation">,</span><br>      tags_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/tags'</span><span class="token punctuation">,</span><br>      blobs_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/git/blobs{/sha}'</span><span class="token punctuation">,</span><br>      git_tags_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/git/tags{/sha}'</span><span class="token punctuation">,</span><br>      git_refs_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/git/refs{/sha}'</span><span class="token punctuation">,</span><br>      trees_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/git/trees{/sha}'</span><span class="token punctuation">,</span><br>      statuses_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/statuses/{sha}'</span><span class="token punctuation">,</span><br>      languages_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/languages'</span><span class="token punctuation">,</span><br>      stargazers_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/stargazers'</span><span class="token punctuation">,</span><br>      contributors_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/contributors'</span><span class="token punctuation">,</span><br>      subscribers_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/subscribers'</span><span class="token punctuation">,</span><br>      subscription_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/subscription'</span><span class="token punctuation">,</span><br>      commits_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/commits{/sha}'</span><span class="token punctuation">,</span><br>      git_commits_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/git/commits{/sha}'</span><span class="token punctuation">,</span><br>      comments_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/comments{/number}'</span><span class="token punctuation">,</span><br>      issue_comment_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/issues/comments{/number}'</span><span class="token punctuation">,</span><br>      contents_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/contents/{+path}'</span><span class="token punctuation">,</span><br>      compare_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/compare/{base}...{head}'</span><span class="token punctuation">,</span><br>      merges_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/merges'</span><span class="token punctuation">,</span><br>      archive_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/{archive_format}{/ref}'</span><span class="token punctuation">,</span><br>      downloads_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/downloads'</span><span class="token punctuation">,</span><br>      issues_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/issues{/number}'</span><span class="token punctuation">,</span><br>      pulls_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/pulls{/number}'</span><span class="token punctuation">,</span><br>      milestones_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/milestones{/number}'</span><span class="token punctuation">,</span><br>      notifications_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/notifications{?since,all,participating}'</span><span class="token punctuation">,</span><br>      labels_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/labels{/name}'</span><span class="token punctuation">,</span><br>      releases_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/releases{/id}'</span><span class="token punctuation">,</span><br>      deployments_url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/deployments'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    score<span class="token operator">:</span> <span class="token number">1</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">]</span></code></pre>
<p data-wordfix="true" id="code-skip-hello-day-37-11">So what I need is definitely in there. Now I just need to figure out how to get it out of the async request on on to my new token.</p>
<h3 id="caching-commit-links" tabindex="-1">Caching Commit Links</h3>
<p data-wordfix="true">Hmm, <a href="https://github.com/markdown-it/markdown-it/blob/master/docs/development.md#i-need-async-rule-how-to-do-it" target="_blank">it looks like getting the async data into there is going to be the most complex part</a>. The right answer has to be caching, and it looks like there is <a href="https://www.11ty.dev/docs/plugins/cache/" target="_blank">an Eleventy native tool for that</a>, but I think that might be overkill. Especially because I want something I <em>can</em> save as basically a static file, since this won't be changing. Also, the Eleventy plugin won't work because it is still async. This means I'm basically required to handle this as a file. Also, need to watch out as if I write to the directory I'm watching, I may end up triggering the watch in a loop.</p>
<p>Another thing I'll need to be careful of when caching this data is if I'm automatically creating files, I should likely be using the query as a file key, that query may contain characters not safe for file names, so I'll need to pull something in to handle sanitization.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-10" id="skip-to-code-skip-hello-day-37-10" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> sanitizeFilename <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"sanitize-filename"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-hello-day-37-10">Ok, so let's start putting it down.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-9" id="skip-to-code-skip-hello-day-37-9" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">commit_pattern</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;=git commit \-am [\"|\'])(.+)(?=[\"|\'])</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token comment">// I can get the "repo" from the post object</span><br><span class="token comment">// Then I need to change the commit message I captured</span><br><span class="token comment">// Queries don't allow spaces, so replace them with "+"</span><br><span class="token keyword">const</span> <span class="token function-variable function">gitSearchQuery</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">repo<span class="token punctuation">,</span> commitMsg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> searchCommitMsg <span class="token operator">=</span> commitMsg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"+"</span><span class="token punctuation">)</span><br>	<span class="token keyword">const</span> repoName <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"https://github.com/"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><br>	<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">repo:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>repoName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>searchCommitMsg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-37-9">Now let's create a function to figure out the path to the new cache folder.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-8" id="skip-to-code-skip-hello-day-37-8" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">cacheFilePath</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pageFilePath<span class="token punctuation">,</span> searchKey</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> cacheFolder <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"../../"</span><span class="token punctuation">,</span> <span class="token string">'/_queryCache'</span><span class="token punctuation">,</span> pageFilePath<span class="token punctuation">)</span><br>	<span class="token keyword">const</span> cacheFile <span class="token operator">=</span> cacheFolder<span class="token operator">+</span><span class="token function">sanitizeFilename</span><span class="token punctuation">(</span><span class="token function">slugify</span><span class="token punctuation">(</span>searchKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>	<span class="token comment">// console.log('cacheFile: ', cacheFile)</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> cacheFolder<span class="token punctuation">,</span> cacheFile <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-37-8">I can use <code>fs.accessSync</code> to check if the file exists before creating a cache. After all I don't want to query GitHub every time I do a build. So we can use this in the process to find the repo commit link.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-7" id="skip-to-code-skip-hello-day-37-7" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">getLinkToRepo</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">repo<span class="token punctuation">,</span> commitMsg<span class="token punctuation">,</span> pageFilePath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> searchKey <span class="token operator">=</span> <span class="token function">gitSearchQuery</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> commitMsg<span class="token punctuation">)</span><br>	<span class="token keyword">const</span> <span class="token punctuation">{</span>cacheFolder<span class="token punctuation">,</span> cacheFile<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">cacheFilePath</span><span class="token punctuation">(</span>pageFilePath<span class="token punctuation">,</span> searchKey<span class="token punctuation">)</span><br>	<span class="token keyword">try</span> <span class="token punctuation">{</span><br>		fs<span class="token punctuation">.</span><span class="token function">accessSync</span><span class="token punctuation">(</span>cacheFile<span class="token punctuation">,</span> fs<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">F_OK</span><span class="token punctuation">)</span><br>		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-hello-day-37-7">If it exists the function ends here and returns true.</p>
<p>But when we know the file doesn't exist we will have to continue using the <code>catch</code>. I'll make a request to GitHub using Octokit. I'm pretty much skipping over how I set up Octokit because this is basically the boilerplate.</p>
<p>The only thing that I have added into the mix here is to get my Github Key using the environment. Locally I'll use DotEnv <code>require('dotenv').config()</code>. But I'll have to figure out how to handle it on GitHub next. And I get the searchKey using my above function <code>gitSearchQuery</code>.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-6" id="skip-to-code-skip-hello-day-37-6" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Query is not cached: '</span><span class="token punctuation">,</span> cacheFile<span class="token punctuation">,</span> e<span class="token punctuation">)</span><br>		<span class="token keyword">const</span> MyOctokit <span class="token operator">=</span> Octokit<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>retry<span class="token punctuation">,</span> throttling<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		<span class="token keyword">const</span> myOctokit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyOctokit</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>		auth<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_KEY</span><span class="token punctuation">,</span><br>		throttle<span class="token operator">:</span> <span class="token punctuation">{</span><br>			<span class="token function-variable function">onRateLimit</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">retryAfter<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>			myOctokit<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><br>				<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request quota exhausted for request </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br>			<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>			<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>request<span class="token punctuation">.</span>retryCount <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				<span class="token comment">// only retries once</span><br>				myOctokit<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Retrying after </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>retryAfter<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> seconds!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>			<span class="token punctuation">}</span><br>			<span class="token punctuation">}</span><span class="token punctuation">,</span><br>			<span class="token function-variable function">onAbuseLimit</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">retryAfter<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>			<span class="token comment">// does not retry, only logs a warning</span><br>				myOctokit<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><br>					<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Abuse detected for request </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br>				<span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<span class="token punctuation">}</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">,</span><br>		retry<span class="token operator">:</span> <span class="token punctuation">{</span><br>			doNotRetry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"429"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token keyword">await</span> myOctokit<span class="token punctuation">.</span>rest<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">commits</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>			q<span class="token operator">:</span> searchKey<span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&amp;&amp;</span> r<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> r<span class="token punctuation">.</span>data<span class="token punctuation">.</span>items <span class="token operator">&amp;&amp;</span> r<span class="token punctuation">.</span>data<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span></code></pre>
<p id="code-skip-hello-day-37-6">Once the commit is found, I'll try to cache it by writing a file using the path to the post and then the search query as a file key.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-5" id="skip-to-code-skip-hello-day-37-5" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">{</span><br>	fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>cacheFolder<span class="token punctuation">,</span> <span class="token punctuation">{</span> recursive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>	<span class="token comment">// console.log('write data to file', cacheFile)</span><br>	fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>cacheFile<span class="token punctuation">,</span> r<span class="token punctuation">.</span>data<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>html_url<span class="token punctuation">)</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'writing to cache failed:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><span class="token keyword">return</span> r<span class="token punctuation">.</span>data<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>html_url</code></pre>
<p id="code-skip-hello-day-37-5">Now that I have a way to handle caching, I need to trigger it as part of the markdown building process.</p>
<h3 id="rendering-link-with-markdown-it" tabindex="-1">Rendering link with Markdown It</h3>
<p>I'll need a process to actually create the link on the commit in the <code>markdown-it</code> way.</p>
<p>I'll need to create HTML tokens for the link open and close as follows:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-4" id="skip-to-code-skip-hello-day-37-4" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">createLinkTokens</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">TokenConstructor<span class="token punctuation">,</span>commitLink</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> link_open <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">'html_inline'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>	link_open<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'&lt;a href="'</span><span class="token operator">+</span>commitLink<span class="token operator">+</span><span class="token string">'" target="_blank">'</span><br>	<span class="token keyword">const</span> link_close <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">'html_inline'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><br>	link_close<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'&lt;/a>'</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span>link_open<span class="token punctuation">,</span> link_close<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-37-4">I'll need to take the markdown-it object and create a new <code>ruler</code> rule. I'll use <code>state.env</code> to check for the <code>repo</code> property and test for the commit pattern in each <code>inline</code> token. By using <code>inline</code> instead of <code>code_inline</code> I will be able to place my new <code>html_inline</code> token around the commit text.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-3" id="skip-to-code-skip-hello-day-37-3" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><br><span class="token keyword">const</span> <span class="token function-variable function">gitCommitRule</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">md</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	md<span class="token punctuation">.</span>core<span class="token punctuation">.</span>ruler<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">'inline'</span><span class="token punctuation">,</span> <span class="token string">'git_commit'</span><span class="token punctuation">,</span> <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		<span class="token keyword">const</span> tokens <span class="token operator">=</span> state<span class="token punctuation">.</span>tokens<br>		<span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'repo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">commit_pattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'inline'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>					<span class="token comment">// console.log('tokens round 1: ', tokens[i])</span><br>					<span class="token keyword">const</span> commitMessage <span class="token operator">=</span> tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token function">commit_pattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><br>					<span class="token keyword">const</span> searchKey <span class="token operator">=</span> <span class="token function">gitSearchQuery</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>env<span class="token punctuation">.</span>repo<span class="token punctuation">,</span> commitMessage<span class="token punctuation">)</span><br>					<span class="token keyword">const</span> <span class="token punctuation">{</span>cacheFolder<span class="token punctuation">,</span> cacheFile<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">cacheFilePath</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>env<span class="token punctuation">.</span>page<span class="token punctuation">.</span>url<span class="token punctuation">,</span> searchKey<span class="token punctuation">)</span><br>					<span class="token function">getLinkToRepo</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>env<span class="token punctuation">.</span>repo<span class="token punctuation">,</span> commitMessage<span class="token punctuation">,</span> state<span class="token punctuation">.</span>env<span class="token punctuation">.</span>page<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">commitLink</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br><br>					<span class="token punctuation">}</span><span class="token punctuation">)</span><br>					<span class="token keyword">let</span> envRepo <span class="token operator">=</span> state<span class="token punctuation">.</span>env<span class="token punctuation">.</span>repo<span class="token punctuation">;</span><br>					<span class="token keyword">let</span> linkToRepo <span class="token operator">=</span> <span class="token string">''</span><br>					<span class="token comment">// Let's make the default link go to the commit log, that makes more sense.</span><br>					linkToRepo <span class="token operator">=</span> envRepo<br>					<span class="token keyword">if</span> <span class="token punctuation">(</span>envRepo<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>						<span class="token comment">// Assure the last character is a "/"</span><br>						linkToRepo <span class="token operator">+=</span> <span class="token string">"/"</span><br>					<span class="token punctuation">}</span><br>					linkToRepo <span class="token operator">+=</span> <span class="token string">"commits/main"</span><br>					<span class="token keyword">try</span> <span class="token punctuation">{</span><br>						fs<span class="token punctuation">.</span><span class="token function">accessSync</span><span class="token punctuation">(</span>cacheFile<span class="token punctuation">,</span> fs<span class="token punctuation">.</span>constants<span class="token punctuation">.</span><span class="token constant">F_OK</span><span class="token punctuation">)</span><br>						linkToRepo <span class="token operator">=</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>cacheFile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>					<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>						<span class="token comment">// No file yet</span><br>						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cached link to repo not ready'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><br>					<span class="token punctuation">}</span><br>					<span class="token keyword">const</span> <span class="token punctuation">{</span> link_open<span class="token punctuation">,</span> link_close <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createLinkTokens</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>Token<span class="token punctuation">,</span>linkToRepo<span class="token punctuation">)</span><br>					tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>link_open<span class="token punctuation">)</span><br>					tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>link_close<span class="token punctuation">)</span><br><br>				<span class="token punctuation">}</span><br>			<span class="token punctuation">}</span><br>		<span class="token punctuation">}</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">md</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token function">gitCommitRule</span><span class="token punctuation">(</span>md<span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h3 id="adding-link-css" tabindex="-1">Adding Link CSS</h3>
<p id="code-skip-hello-day-37-3">It's looking good here, though it isn't super clear that it is a link. Maybe I can add some style to it. Let me grab an <a href="https://www.pinclipart.com/downpngs/iRxxRho_link-icon-navy-blue-blue-link-icon-png/" target="_blank">image of a link</a> to add to the style. <a href="https://onlinepngtools.com/resize-png" target="_blank">I'll need to size it down</a>.</p>
<p><a target="_blank" href="https://github.com/AramZS/devblog/commit/16c34c4dc621d3784e9cf14be6b8be8574c2368f" class="git-commit-link"><code>git commit -am &quot;Adding links to commits across all new posts along with a whole new plugin for building links to commits automatically into new posts for day 37&quot;</code></a></p>
<p>Then I can add the CSS.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-2" id="skip-to-code-skip-hello-day-37-2" class="skip-link">Skip code block ▼</a></p>
<pre class="language-scss"><code class="language-scss">.git-commit-link<br>    <span class="token property">text-decoration</span><span class="token punctuation">:</span> underline<br>    &amp;<span class="token punctuation">:</span>hover<br>        <span class="token property">text-decoration-color</span><span class="token punctuation">:</span> grey<br>    &amp;<span class="token punctuation">:</span>after<br>        <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">' '</span><br>        <span class="token property">background</span><span class="token punctuation">:</span> transparent <span class="token url">url</span><span class="token punctuation">(</span>/img/linkicon-s.png<span class="token punctuation">)</span> center right no-repeat<br>        <span class="token property">font-weight</span><span class="token punctuation">:</span> normal<br>        <span class="token property">font-style</span><span class="token punctuation">:</span> normal<br>        <span class="token property">margin</span><span class="token punctuation">:</span> 0px 0px 0px 10px<br>        <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<br>        <span class="token property">background-size</span><span class="token punctuation">:</span> contain<br>        <span class="token property">display</span><span class="token punctuation">:</span> inline-block<br>        <span class="token property">width</span><span class="token punctuation">:</span> 12px<br>        <span class="token property">height</span><span class="token punctuation">:</span> 12px</code></pre>
<p id="code-skip-hello-day-37-2"><a target="_blank" href="https://github.com/AramZS/devblog/commit/342836cd4780ce10e42d18a5c34d4403e5101d3c" class="git-commit-link"><code>git commit -am &quot;Set the default link for repos to go to the main commit log&quot;</code></a></p>
<h3 id="touch-up-of-markdown-it-link-process" tabindex="-1">Touch Up of Markdown It Link Process</h3>
<p>After <a href="https://github.com/markdown-it/markdown-it/issues/834" target="_blank">getting a very helpful response from the Markdown-It team</a> it looks like the <code>html_inline</code> process I used to add the link isn't really best practice.</p>
<h4 id="push-to-end-of-core-rules" tabindex="-1">Push to end of core rules</h4>
<p>So I found two changes I needed to make. First, I needed to push the rule as the last <code>core</code> rule. It turns out there is a function specifically for this, so I used it and now declare my rule using <code>md.core.ruler.push('git_commit', state =&gt; {</code>.</p>
<h4 id="create-link-tokens" tabindex="-1">Create link tokens</h4>
<p>The other change is to use <code>TokenConstructer</code> to make a real token and not <code>html_inline</code> which doesn't have any of the tools and hooks that a normal token does. So now my function to create tokens looks like:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-37-1" id="skip-to-code-skip-hello-day-37-1" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">setAttr</span><span class="token punctuation">(</span><span class="token parameter">token<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> index <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> attr <span class="token operator">=</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		token<span class="token punctuation">.</span><span class="token function">attrPush</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>		token<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> attr<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">createLinkTokens</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">TokenConstructor<span class="token punctuation">,</span> commitLink</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> link_open <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"link_open"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"target"</span><span class="token punctuation">,</span> <span class="token string">"_blank"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"href"</span><span class="token punctuation">,</span> commitLink<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"git-commit-link"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token comment">// This is haunting me, so I asked - https://github.com/markdown-it/markdown-it/issues/834</span><br>	<span class="token keyword">const</span> link_close <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"link_close"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> link_open<span class="token punctuation">,</span> link_close <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-hello-day-37-1">The 1/-1 here allows me to open and close the <code>a</code> tag and now I can use the <code>attrPush</code> on the token which is a much better practice.</p>
<p>Great!</p>
<p><a target="_blank" href="https://github.com/AramZS/devblog/commit/af17fab3dd8a9f99200ecd93518eef2e5d7aaccc" class="git-commit-link"><code>git commit -am &quot;Switching git-commit process to build link using link_open and link_close&quot;</code></a></p>
<h4 id="can't-start-secrets-with-github" tabindex="-1">Can't start secrets with GITHUB</h4>
<p>While prepping to merge I wanted to add the GITHUB_KEY <code>env</code> secret. But it turns out I can't start my keynames with <code>GITHUB_</code>. So I gotta rename it.</p>

                    
                    </section>
                    <section id="postcontent">
                    
    
        
        
        <div class="pagination">
            <a href="/posts/projects/devblog/hello-day-36/" class="pagination-link cursor-pointer ">Previous Day</a>

            <a href="/posts/projects/devblog/hello-day-38/" class="pagination-link cursor-pointer ">Next Day</a>
        </div>
    
    <div class="social-icons-block">
    <div class="a-social-icon">
        <a href="https://github.com/AramZS/" target="_blank">
            <svg role="img" viewBox="0 0 24 24" class="twitter-icon social-icon" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>


<!-- https://simpleicons.org/?q=github -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://bit.ly/aramzs" target="_blank">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>


<!-- https://simpleicons.org/?q=linked -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://twitter.com/Chronotope" target="_blank">
            <svg role="img" class="twitter-icon social-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>

<!-- https://simpleicons.org/?q=tw -->

        </a>
    </div>
    
</div>


                    </section>
                </main>
                <footer>
                    
    <div id="taglist">
        <h6>Tags: </h6>
        <ul><li>
                    <a href="https://fightwithtools.dev/tag/starters">Starters</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/11ty">11ty</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/node">Node</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/wip">WiP</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/markdown-it">Markdown-It</a>
                </li></ul>
    </div>

                    
                        <p>
                            <small>Hosted on <a href="https://pages.github.com" target="_blank">GitHub Pages</a> based on <a href="https://github.com/pages-themes/dinky" target="_blank">the Dinky theme</a>. <a href="https://github.com/AramZS/devblog" target="_blank">See the code</a>.</small>
                        </p>
                    
                    
                </footer>
            </div>
            <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        </body>
    </html>
