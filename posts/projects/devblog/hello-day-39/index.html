<!doctype html>
    <html lang="en-US" id="template-post" class="base">
        <head>
        
        <script defer="" data-domain="fightwithtools.dev" src="https://plausible.io/js/plausible.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Fight With Tools: A Dev Blog RSS" href="https://fightwithtools.dev/rss/">
    	<link rel="alternate" type="application/atom+xml" title="Fight With Tools: A Dev Blog Feed" href="https://fightwithtools.dev/feed/">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Part 39: Tweaking Code Blocks and Adding Skip Links</title>
        
            <!-- Sub Template: post -->
        
        
            <link rel="preload" as="font">
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="preload" as="style">
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="stylesheet">
            <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=21341656646" /> -->
            <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=21341656646" id="">

            
                <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=21341656646" /> -->
                <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=21341656646" id="">

            
            <!-- Build Revision: 21341656646 & Sha: c948173c3e820198bc5a54015d96bd59143b22b1 -->
            <script src="https://fightwithtools.dev/assets/js/scale.fix.js" async=""></script>
            <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
            <!--[if lt IE 9]>
                <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
            <![endif]-->
        
        
            <!-- The Author meta propagates the byline in a number of social networks -->
<meta name="author" content="Aram Zucker-Scharff">

<meta property="og:title" content="Part 39: Tweaking Code Blocks and Adding Skip Links">

<meta property="og:description" content="More devblog">


<meta property="og:url" content="https://fightwithtools.dev/posts/projects/devblog/hello-day-39/">

<meta property="og:site_name" content="Fight With Tools: A Dev Blog">

<meta property="og:locale" content="en_US">

<meta name="twitter:site" content="@chronotope">

<meta name="twitter:description" content="More devblog">

<meta name="description" content="More devblog">

<!-- I prefer the summary_large_image Twitter card for posts. -->
<meta name="twitter:card" content="summary_large_image">
<!-- You, you're the creator. -->
<meta name="twitter:creator" content="@chronotope">
<!-- This property is for the article title, not site title. -->
<meta name="twitter:title" content="Part 39: Tweaking Code Blocks and Adding Skip Links">



<meta property="og:image" content="https://fightwithtools.dev/img/close-up-keys.jpg">
<meta name="twitter:image" content="https://fightwithtools.dev/img/close-up-keys.jpg">




    <!-- Article specific OG data -->
    <!-- The OG:Type dictates a number of other tags on posts. -->
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="Fri, 26 Nov 2021 02:59:43 GMT">

    <!-- page.modified isn't a natural Jekyll property, but it can be added. -->
    

    <!-- Here my author and publisher tags are the same (yay self-publishing) -->
    <meta property="article:author" content="http://facebook.com/aramzs">
    <!-- But if your site has its own page, this is where to put it. -->
    <meta property="article:publisher" content="https://www.facebook.com/aramzs">

    
    <!-- Article section isn't a required property, but it can be good to have -->
    <meta property="article:section" content="Dev Blog">
    

    
        <!-- I use the page.categories property for OG tags. -->
        
        <meta property="article:tag" content="posts">
        
        <meta property="article:tag" content="projects">
        
        <meta property="article:tag" content="Starters">
        
        <meta property="article:tag" content="11ty">
        
        <meta property="article:tag" content="Node">
        
        <meta property="article:tag" content="WiP">
        
        <meta property="article:tag" content="Markdown-It">
        
        <meta property="article:tag" content="Sass">
        
        <meta property="article:tag" content="a11y">
        
        <meta name="keywords" content="posts, projects, Starters, 11ty, Node, WiP, Markdown-It, Sass, a11y">
    



            <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Blog",
        "url": "https://fightwithtools.dev/posts/projects/devblog/hello-day-39/",
        "headline": "Part 39: Tweaking Code Blocks and Adding Skip Links",
        "about": "More devblog",
        "image": [
            "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
        ],
        "isAccessibleForFree": "True",
        "isPartOf": {
            "@type": ["CreativeWork", "Product"],
            "name": "Fight With Tools",
            "productID": "fightwithtools.dev"
        },
        "discussionUrl": "https://twitter.com/search?q=to%3AChronotope%20%23dev&src=typed_query&f=top",
        "author": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Lead Privacy Engineer at The Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": "https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg"
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
}, 
        "editor": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Lead Privacy Engineer at The Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": "https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg"
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
},
        "inLanguage": "en-US",
        "license": "http://creativecommons.org/licenses/by-sa/4.0/",
        "additionalType": "CreativeWork",
        "alternateName": "Fight With Tools Dev",
        "publisher": {
            "@type": "Organization",
            "name": "Fight With Tools",
            "description": "A site discussing how to imagine, build, analyze and use cool code and web tools. Better websites, better stories, better developers. Technology won't save the world, but you can.",
            "sameAs": "https://fightwithtools.dev/",
            "logo": {
                "@type": "ImageObject",
                "url": "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
            },
            "publishingPrinciples": "http://aramzs.github.io/about/"
        }
    }
</script>

        
        
        
<link rel="canonical" href="https://fightwithtools.dev/posts/projects/devblog/hello-day-39/">

        </head>
        <body itemscope="" itemtype="https://schema.org/Blog">
            <div class="wrapper">
                <header>
                    
                        
                            <div id="site-name-subhead">
                                <a href="https://fightwithtools.dev">Fight With Tools: A Dev Blog</a>
                                
                                    > <a id="project-link" href="https://fightwithtools.dev/projects/devblog">Dev Blog</a>
                                
                            </div>
                        
                        
                            <!-- post mode -->
                            <time>Fri Nov 26 2021</time>
                            <!-- front matter dates made in format at https://yaml.org/type/timestamp.html -->
                        
                        
                            <!-- projects mode -->
                        
                        <h1 class="header" id="part-39-tweaking-code-blocks-and-adding-skip-links">
                            Part 39: Tweaking Code Blocks and Adding Skip Links
                        </h1>
                        
                        
                    
                    
    <h5 itemprop="author" itemscope="" itemtype="https://schema.org/Person" id="by-aram-zucker-scharff">
    <link itemprop="sameAs" href="http://aramzs.github.io/aramzs/">
    By <span itemprop="name"><a href="http://aramzs.github.io/aramzs/" target="_blank">Aram Zucker-Scharff</a></span>
</h5>

                </header>
                <main>
                    
    <section id="precontent">
        <aside id="toc-container">
            <div id="toc-container__inner">
                <h2 id="contents">Contents</h2>
                <nav class="toc">
        <ol><li><a href="#project-scope-and-todos">Project Scope and ToDos</a></li><li><a href="#day-39">Day 39</a><ol><li><a href="#fix-anchors">Fix anchors</a></li><li><a href="#making-code-blocks-more-readable">Making Code Blocks More Readable</a></li><li><a href="#add-skip-links-to-code-blocks">Add skip links to code blocks</a></li></ol></li></ol>
      </nav>
            </div>
        </aside>
        <div id="post-description">More devblog</div>

        
    <figure class="figure preview-image">
        <img src="https://fightwithtools.dev/img/close-up-keys.jpg" alt="Close up photo of keyboard keys.">
        
            <figcaption class="figcaption">
                
                 | <em>
                        <a href="https://www.flickr.com/photos/40393390@N00/2386752252" target="_blank">'TYPE' by SarahDeer is licensed with CC BY 2.0</a>
                    </em> | 
            </figcaption>
        
    </figure>


    </section>

                    <section id="maincontent" class="maincontent">
                    
                        <h2 id="project-scope-and-todos" tabindex="-1">Project Scope and ToDos</h2>
<ol>
<li>Static Site Generator that can build the blog and let me host it on Github Pages</li>
<li>I want to write posts in Markdown because I'm lazy, it's easy, and it is how I take notes now.</li>
<li>I don't want to spend a ton of time doing design work. I'm doing complicated designs for other projects, so I want to pull a theme I like that I can rely on someone else to keep up.</li>
<li>Once it gets going, I want template changes to be easy.</li>
<li>It should be as easy as Jekyll, so I need to be able to build it using GitHub Actions, where I can just commit a template change or Markdown file and away it goes. If I can't figure this out than fk it, just use Jekyll.</li>
<li>I require it to be used by a significant percent of my professional peers so I can get easy answers when something goes wrong.</li>
<li>I want source maps. This is a dev log site which means whatever I do with it should be easy for other developers to read.</li>
</ol>
<ul class="task-list">
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Also <a href="https://www.npmjs.com/package/@quasibit/eleventy-plugin-sitemap" target="_blank">the sitemap plugin</a> looks cool. Should grab that later.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" class="markdown-todo"> So does the <a href="https://www.npmjs.com/package/eleventy-plugin-reading-time" target="_blank">reading time one</a>.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Also <a href="https://github.com/jdsteinbach/eleventy-plugin-toc/" target="_blank">this TOC plugin</a> mby?</p>
</li>
<li class="task-list-item">
<p data-wordfix="true"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Use <a href="https://www.11ty.dev/docs/data-deep-merge/" target="_blank">Data Deep Merge</a> in this blog.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Decide if I want to render the CSS fancier than just a base file and do per-template splitting.</p>
</li>
</ul>
<s>
<ul class="task-list">
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> Can I use the template inside of dinky that already exists instead of copy/pasting it?</li>
</ul>
</s>
<s>
<ul class="task-list">
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> Is there a way to have permalinks to posts contain metadata without organizing them into subfolders?</li>
</ul>
</s>
<ul class="task-list">
<li class="task-list-item">
<p data-wordfix="true"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> How do I cachebreak files on the basis of new build events? Datetime? <code>site.github.build_revision</code> is <a href="https://github.com/jekyll/github-metadata/blob/master/docs/site.github.md" target="_blank">how Jekyll accomplishes this</a>, but is there a way to push <a href="https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context" target="_blank">that</a> <a href="https://stackoverflow.com/questions/54310050/how-to-version-build-artifacts-using-github-actions" target="_blank">into the build process</a> for Eleventy?</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Make link text look less shitty. It looks like it is a whole, lighter, font.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Code blocks do not have good syntax highlighting. I want good syntax highlighting.</p>
</li>
<li class="task-list-item">
<p data-wordfix="true"><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Build a Markdown-it plugin to take my typing shortcuts <code>[prob, b/c, ...?]</code> and expand them on build.</p>
</li>
</ul>
<s>
<ul class="task-list">
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"> See if we can start Markdown's interpretation of H tags to <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements#multiple_h1" target="_blank">start at 2, since H1</a> is always pulled from the page title metadata. If it isn't easy, I just have to change my pattern of writing in the MD documents.</li>
</ul>
</s>
<ul class="task-list">
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Should I <a href="https://www.madebymike.com.au/writing/11ty-filters-data-shortcodes/" target="_blank">explore some shortcodes</a>?</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Order projects listing by last posted blog in that project</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Limit the output of home page post lists to a specific number of posts</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Show the latest post below the site intro on the homepage.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Tags pages with Pagination</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Posts should be able to support a preview header image that can also be shown on post lists.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Create a Markdown-It plugin that reads the project's repo URL off the folder data file and renders commit messages with <a href="https://stackoverflow.com/questions/15919635/on-github-api-what-is-the-best-way-to-get-the-last-commit-message-associated-w" target="_blank">links to the referenced commit</a>. (Is this even possible?) (Is there a way to do it with eleventy instead?)</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Create Next Day/Previous Day links on each post / Next/Previous post on post templates from projects</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Tags should be in the sidebar of articles and link to tag pages</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Create a skiplink for the todo section (or would this be better served with the ToC plugin?) - Yes it would be!</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Add a Things I Learned section to the project pages that are the things I learned from that specific project.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Add a technical reading log to the homepage</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:empty" target="_blank">Hide</a> empty sections.</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Add byline to post pages</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Have table of contents attach to sidebar bottom on mobile</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Support dark mode</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> Social Icons</p>
</li>
<li class="task-list-item">
<p><input disabled="true" type="checkbox" checked="true" class="markdown-todo"> SEO/Social/JSON-LD HEAD data</p>
</li>
</ul>
<h2 id="day-39" tabindex="-1">Day 39</h2>
<p>Look at this! Every checkmark I want to check off is checked off! Now all I have left to do is close off the last few things that are broken!</p>
<h3 id="fix-anchors" tabindex="-1">Fix anchors</h3>
<p>My anchor link generator is being broken by double-quote marks.</p>
<p>I'll change the configuration for <code>markdown-it-anchor</code> as follows:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-16" id="skip-to-code-skip-hello-day-39-16" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"markdown-it-anchor"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>			<span class="token function-variable function">slugify</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">slugify</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p id="code-skip-hello-day-39-16">And yeah, that works!</p>
<h3 id="making-code-blocks-more-readable" tabindex="-1">Making Code Blocks More Readable</h3>
<p>So I'm going to make a few changes to the codeblocks in general here to make them more consumable.</p>
<p>First, it looks like the wisdom of the crowds is leaning towards wrapping code lines. So I'm going to add some CSSto do that:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-15" id="skip-to-code-skip-hello-day-39-15" class="skip-link">Skip code block ▼</a></p>
<pre class="language-css"><code class="language-css"><span class="token selector">code[class*="language-"], pre[class*="language-"]</span> <span class="token punctuation">{</span><br>	<span class="token property">white-space</span><span class="token punctuation">:</span>pre-wrap<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-15">Next, I use 4-space tabs and that can make my code blocks pretty roomy. Let's resize those tabs by adding a new property to the same css rule. Instead I can shrink it down to <code>1em</code> with <code>tab-size: 1em;</code>. This won't change spaces in codeblocks like YAML, but it helps with most of the rest I think.</p>
<p>There's one problem that I don't think I can solve with CSS? Some of my early code blocks take the tab level of their files so they have a bunch of extra tabs that aren't needed and make them less readable. Is there a way to fix this? I can't think of one, so I'll just try and remember to collapse my code blocks to start at zero tabs.</p>
<p>Finally, for the very long code blocks, they <em>badly</em> need skip links, both for accessibility and good UI reasons.</p>
<p>I guess... this needs to be another markdown-it plugin? That is where the code-blocks are made. Ok!</p>
<p><a target="_blank" href="https://github.com/AramZS/devblog/commit/47464cbd5d34d5a1ad5ed1aef0bc001ccde6956b" class="git-commit-link"><code>git commit -am &quot;Fix some basic readability issues&quot;</code></a></p>
<h3 id="add-skip-links-to-code-blocks" tabindex="-1">Add skip links to code blocks</h3>
<p>Ok, I'm not going to make the same mistake I did before of starting in my <code>.eleventy</code> file. Let's open up a new custom plugin folder.</p>
<p>Now, because of my investigation on <a href="https://fightwithtools.dev/posts/projects/devblog/hello-day-36/" target="_blank">Day 36</a> I know that there is a <code>code_block</code> rule that is absolutely the one I'm going to need to deal with. And, because I need to manipulate the token tree <em>around</em> the code block, I know that I'm going to have to use <code>ruler</code> and not <code>renderer</code>.</p>
<p>Ok, so first I'm going to figure out what token types exist:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-14" id="skip-to-code-skip-hello-day-39-14" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Token Types'</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span>tokens<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevV<span class="token punctuation">,</span> currV</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> prevV<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>currV<span class="token punctuation">.</span>type<span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p id="code-skip-hello-day-39-14">Result:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-13" id="skip-to-code-skip-hello-day-39-13" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><br>  <span class="token string">'ordered_list_open'</span><span class="token punctuation">,</span><br>  <span class="token string">'list_item_open'</span><span class="token punctuation">,</span><br>  <span class="token string">'paragraph_open'</span><span class="token punctuation">,</span><br>  <span class="token string">'inline'</span><span class="token punctuation">,</span><br>  <span class="token string">'paragraph_close'</span><span class="token punctuation">,</span><br>  <span class="token string">'list_item_close'</span><span class="token punctuation">,</span><br>  <span class="token string">'ordered_list_close'</span><span class="token punctuation">,</span><br>  <span class="token string">'bullet_list_open'</span><span class="token punctuation">,</span><br>  <span class="token string">'bullet_list_close'</span><span class="token punctuation">,</span><br>  <span class="token string">'html_block'</span><span class="token punctuation">,</span><br>  <span class="token string">'heading_open'</span><span class="token punctuation">,</span><br>  <span class="token string">'heading_close'</span><span class="token punctuation">,</span><br>  <span class="token string">'blockquote_open'</span><span class="token punctuation">,</span><br>  <span class="token string">'blockquote_close'</span><span class="token punctuation">,</span><br>  <span class="token string">'fence'</span><br><span class="token punctuation">]</span></code></pre>
<p id="code-skip-hello-day-39-13">Ok, so nothing clearly shows my codeblocks. So, let's try a different strategy. What about looking for my markdown codeblock indicator the three backticks?</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-12" id="skip-to-code-skip-hello-day-39-12" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">```</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-12">Nope...</p>
<p>Ok, let's look for <code>&lt;code&gt;</code>?</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-11" id="skip-to-code-skip-hello-day-39-11" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\&lt;code\></span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-11">Ok, that sort of worked! This is good!</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-10" id="skip-to-code-skip-hello-day-39-10" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript">Token <span class="token punctuation">{</span><br>  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'fence'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">168</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">nesting</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'for (let i = 0; i &lt; tokens.length; i++) {\n'</span> <span class="token operator">+</span><br>    <span class="token string">'\tif (/```/.test(tokens[i].content)){\n'</span> <span class="token operator">+</span><br>    <span class="token string">'\t\tconsole.log(tokens[i])\n'</span> <span class="token operator">+</span><br>    <span class="token string">'\t}\n'</span> <span class="token operator">+</span><br>    <span class="token string">'}\n'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">markup</span><span class="token operator">:</span> <span class="token string">'```'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">'javascript'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">hidden</span><span class="token operator">:</span> <span class="token boolean">false</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-10">Interesting. Maybe this could eventually be a way to fix some of the bad tabbing? I think this is a little out of scope, so I'll put that aside for now. This is a good place to start!</p>
<p>What does this token tree look like? Maybe I can look around it.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-9" id="skip-to-code-skip-hello-day-39-9" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">"fence"</span> <span class="token operator">&amp;&amp;</span> tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tag <span class="token operator">==</span> <span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> tokens<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-9">Ok, I guess there isn't anything relevant? All are surrounded by <code>paragraph_close</code> and <code>paragraph_open</code>. So I'll need to construct the skip links around the token basically from scratch. Likely I'll need to create new paragraphs?</p>
<p>Though to make the skip link work effectively I think I'll need to add an ID to the following <code>paragraph_open</code> token that looks like this:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-8" id="skip-to-code-skip-hello-day-39-8" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript">Token <span class="token punctuation">{</span><br>  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'paragraph_open'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token string">'data-wordfix'</span><span class="token punctuation">,</span> <span class="token string">'true'</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">114</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">nesting</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">markup</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">hidden</span><span class="token operator">:</span> <span class="token boolean">false</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-8"><a target="_blank" href="https://github.com/AramZS/devblog/commit/28b520ed3b9bdad03c8c470a9113c330ea69fb94" class="git-commit-link"><code>git commit -am &quot;Saving part way through day 39&quot;</code></a></p>
<p>I'll also need some way to name the skip links. I've been thinking about this and I think I should be able to just increment a count on <code>state.env</code> since Markdown It processing occurs synchronously, right? I can pull the <code>fileSlug</code> off the page object just to be sure the anchor links are unique enough.</p>
<p>Ok, so I'm going to create the skip link name:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-7" id="skip-to-code-skip-hello-day-39-7" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>env<span class="token punctuation">.</span>state<span class="token punctuation">.</span>page<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'skipCount'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>	env<span class="token punctuation">.</span>state<span class="token punctuation">.</span>page<span class="token punctuation">.</span>skipCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token keyword">const</span> skipCount <span class="token operator">=</span> env<span class="token punctuation">.</span>state<span class="token punctuation">.</span>page<span class="token punctuation">.</span>skipCount <span class="token operator">+</span> <span class="token number">1</span><br>env<span class="token punctuation">.</span>state<span class="token punctuation">.</span>page<span class="token punctuation">.</span>skipCount <span class="token operator">=</span> skipCount<span class="token punctuation">;</span><br><span class="token keyword">const</span> skipName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">code-skip-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skipCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></code></pre>
<p id="code-skip-hello-day-39-7">And I'm going to apply the skip name to the following paragraph. But, what if the next block isn't a paragraph? I guess we got to check for that.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-6" id="skip-to-code-skip-hello-day-39-6" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> foundGraf <span class="token operator">=</span> <span class="token boolean">false</span><br><span class="token keyword">let</span> nextI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>foundGraf<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">++</span>nextI<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"paragraph_open"</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>		foundGraf <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>		<span class="token keyword">break</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-6">Ok, didn't quite work. I guess there could be an end of the article or a non-paragraph token? Let's take that into account.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-5" id="skip-to-code-skip-hello-day-39-5" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>foundGraf<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">++</span>nextI<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> tokens<span class="token punctuation">[</span>i<span class="token operator">+</span>nextI<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> tokens<span class="token punctuation">[</span>i<span class="token operator">+</span>nextI<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"paragraph_open"</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>		foundGraf <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>		<span class="token function">addSkipGrafID</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token operator">+</span>nextI<span class="token punctuation">]</span><span class="token punctuation">,</span> skipName<span class="token punctuation">)</span><br>		<span class="token keyword">break</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tokens<span class="token punctuation">[</span>i<span class="token operator">+</span>nextI<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>		<span class="token comment">// do something</span><br>		<span class="token comment">// I guess we're at the end?</span><br>		foundGraf <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>		<span class="token keyword">break</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-hello-day-39-5">Ok so this applies the needed ID! I now need to build the paragraph block above the code block and place te skip link. Good to refer to <a href="https://fightwithtools.dev/posts/projects/devblog/hello-day-34/#a-more-complex-markdown-it-token" target="_blank">the complex Markdown It chain I recorded on Day 34</a>.</p>
<p>I'm really unclear how the nesting property is supposed to work? I guess we will just try it and see!</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-4" id="skip-to-code-skip-hello-day-39-4" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">createSkipLink</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">TokenConstructor<span class="token punctuation">,</span> skipName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> p_open <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"paragraph_open"</span><span class="token punctuation">,</span> <span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>p_open<span class="token punctuation">,</span> <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"skip-link-graf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	p_open<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>	<span class="token keyword">const</span> link_open <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"link_open"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skipName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">skip-to-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skipName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"skip-link"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	p_open<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>link_open<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> link_text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	link_text<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">"Skip code block &amp;#9660;"</span><br>	p_open<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>link_text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> link_close <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"link_close"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	p_open<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>link_close<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> p_close <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"paragraph_close"</span><span class="token punctuation">,</span> <span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> p_open<span class="token punctuation">,</span> p_close <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-hello-day-39-4">Once I have my tokens, I can splce them into the token tree!</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-3" id="skip-to-code-skip-hello-day-39-3" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Create skip link'</span><span class="token punctuation">)</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> p_open<span class="token punctuation">,</span> p_close <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createSkipLink</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>Token<span class="token punctuation">,</span> skipName<span class="token punctuation">)</span><br>tokens<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p_close<span class="token punctuation">)</span><br>tokens<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> p_open<span class="token punctuation">)</span></code></pre>
<p id="code-skip-hello-day-39-3">Ok, apparently doing this drives the build process into an infinite loop? That's not great. What do I do now?</p>
<p>Ok, found the nesting info:</p>
<blockquote>
<p>Level change (number in {-1, 0, 1} set), where:</p>
<ul>
<li>1 means the tag is opening</li>
<li>0 means the tag is self-closing</li>
<li>-1 means the tag is closing</li>
</ul>
</blockquote>
<p>Got it. Well, fixing that doesn't seem to have fixed anything, still looping.</p>
<p>Let's <a href="https://github.com/markdown-it/markdown-it/blob/master/docs/architecture.md" target="_blank">read some docs I guess</a>!</p>
<p>Well <a href="https://markdown-it.github.io/" target="_blank">it looks like</a> I'm not supposed to put children on the paragraph token. In fact, it looks like it is supposed to be flat.</p>
<p>Ok tried:</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-2" id="skip-to-code-skip-hello-day-39-2" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">createSkipLink</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">TokenConstructor<span class="token punctuation">,</span> skipName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> p_open <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"paragraph_open"</span><span class="token punctuation">,</span> <span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>p_open<span class="token punctuation">,</span> <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"skip-link-graf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	p_open<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">0</span><br>	<span class="token comment">// p_open.children = []</span><br>	<span class="token keyword">const</span> link_open <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"link_open"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skipName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">skip-to-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skipName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">setAttr</span><span class="token punctuation">(</span>link_open<span class="token punctuation">,</span> <span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"skip-link"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	link_open<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">1</span><br>	<span class="token comment">// p_open.children.push(link_open);</span><br>	<span class="token keyword">const</span> link_text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	link_text<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">"Skip code block &amp;#9660;"</span><br>	link_text<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">2</span><br>	<span class="token comment">// p_open.children.push(link_text);</span><br>	<span class="token keyword">const</span> link_close <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"link_close"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	link_close<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">1</span><br>	<span class="token comment">// p_open.children.push(link_close);</span><br>	<span class="token keyword">const</span> p_close <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenConstructor</span><span class="token punctuation">(</span><span class="token string">"paragraph_close"</span><span class="token punctuation">,</span> <span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span> p_open<span class="token punctuation">,</span> link_open<span class="token punctuation">,</span> link_text<span class="token punctuation">,</span> link_close<span class="token punctuation">,</span> p_close <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-hello-day-39-2">Still looping.</p>
<p>Ok, it is not my token making process, it's what happens when I splice the tokens into the chain.</p>
<p>Ok... so how <em>do</em> I add new tokens?</p>
<p>Ok, did some searching and <a href="https://docs.joshuatz.com/cheatsheets/node-and-npm/markdown-it/" target="_blank">maybe there are functions to handle this</a> on the <code>state</code> object?</p>
<p>Let's see what keys are available on the <code>state</code> object.</p>
<p class="skip-link-graf">
<a href="#code-skip-hello-day-39-1" id="skip-to-code-skip-hello-day-39-1" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span> <span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token string">'tokens'</span><span class="token punctuation">,</span> <span class="token string">'inlineMode'</span><span class="token punctuation">,</span> <span class="token string">'md'</span> <span class="token punctuation">]</span></code></pre>
<p id="code-skip-hello-day-39-1">Ok, not useful.</p>
<p>Ok, maybe it is an issue with a particular token? My approach <a href="https://github.com/valeriangalliat/markdown-it-anchor/issues/100" target="_blank">looks</a> like it should work. Let's see what we can add without the loop happening.</p>
<p>Oh, duh, ok the for loop is hitting the same item over and over again as new items are added above it. I'm dumb. I can <a href="https://github.com/markdown-it/markdown-it/blob/master/lib/rules_core/linkify.js#L39" target="_blank">take the approach from the linkify plugin</a> and just reverse it.</p>
<p>Oh, only now my little renderer hack for adding <code>_blank</code> targets to all the links is adding targets to the skip links which is bad. I can use the <code>meta</code> property of the tokens to note that these links are skip links and they should not be treated to <code>_blank</code> targeting.</p>
<p>Ok, looking good. It's working!</p>
<p><a target="_blank" href="https://github.com/AramZS/devblog/commit/f0cf05c92218260c5f768cbe40aa6d60616fde9b" class="git-commit-link"><code>git commit -am &quot;Adding skip links to code blocks&quot;</code></a></p>
<p>Ok. So now I just need to give it some better styling!</p>
<p>Looking good enough for now! I may want to play with it a bit but this looks like a good place to stop.</p>
<p><a target="_blank" href="https://github.com/AramZS/devblog/commit/c786f12bc6709dfec2ed1104c0a078e3eb101a0e" class="git-commit-link"><code>git commit -am &quot;Finish day 39&quot;</code></a></p>

                    
                    </section>
                    <section id="postcontent">
                    
    <script src="https://utteranc.es/client.js" repo="AramZS/fightwithtools-comments" issue-term="title" theme="github-dark" crossorigin="anonymous" async="">
    </script>
    
        
        
        <div class="pagination">
            <a href="/posts/projects/devblog/hello-day-38/" class="pagination-link cursor-pointer ">Previous Day</a>

            <a href="/posts/projects/devblog/markdown-it-find-and-replace/" class="pagination-link cursor-pointer ">Next Day</a>
        </div>
    
    <div class="social-icons-block">
    <div class="a-social-icon">
        <a href="https://github.com/AramZS/" target="_blank">
            <svg role="img" viewBox="0 0 24 24" class="twitter-icon social-icon" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>


<!-- https://simpleicons.org/?q=github -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://bit.ly/aramzs" target="_blank">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg>


<!-- https://simpleicons.org/?q=linked -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://twitter.com/Chronotope" target="_blank">
            <svg role="img" class="twitter-icon social-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg>

<!-- https://simpleicons.org/?q=tw -->

        </a>
    </div>
    
    <div class="a-social-icon">
        <a href="https://indieweb.social/@Chronotope" rel="me" target="_blank">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.193 7.88c0-5.207-3.411-6.733-3.411-6.733C18.062.357 15.108.025 12.041 0h-.076c-3.069.025-6.02.357-7.74 1.147 0 0-3.412 1.526-3.412 6.732 0 1.193-.023 2.619.015 4.13.124 5.092.934 10.11 5.641 11.355 2.17.574 4.034.695 5.536.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.13.54c-2.165-.075-4.449-.234-4.799-2.892a5.5 5.5 0 0 1-.048-.745s2.125.52 4.818.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.508.475-6.508zm-4.024 6.709h-2.497v-6.12c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.313v3.349h-2.484v-3.35c0-1.537-.602-2.313-1.802-2.313-1.085 0-1.628.655-1.628 1.945v6.119H4.831V8.285c0-1.29.328-2.314.987-3.07.68-.759 1.57-1.147 2.674-1.147 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.305z"></path></svg>

<!-- https://simpleicons.org/?q=mastodon -->

        </a>
    </div>

</div>


                    </section>
                </main>
                <footer>
                    
    <div id="taglist">
        <h6 id="tags">Tags: </h6>
        <ul><li>
                    <a href="https://fightwithtools.dev/tag/projects">projects</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/starters">Starters</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/11ty">11ty</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/node">Node</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/wip">WiP</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/markdown-it">Markdown-It</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/sass">Sass</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/a11y">a11y</a>
                </li></ul>
    </div>

                    
                        <p>
                            <small>Hosted on <a href="https://pages.github.com" target="_blank">GitHub Pages</a> based on <a href="https://github.com/pages-themes/dinky" target="_blank">the Dinky theme</a>. <a href="https://github.com/AramZS/devblog" target="_blank">See the code</a>.</small>
                        </p>
                    
                    
                </footer>
            </div>
            <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        </body>
    </html>
