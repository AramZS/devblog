<!doctype html>
    <html lang="en-US" id="template-post" class="base">
        <head>
        
        <script defer data-domain="fightwithtools.dev" src="https://plausible.io/js/plausible.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Fight With Tools: A Dev Blog RSS" href="https://fightwithtools.dev/rss/" />
    	<link rel="alternate" type="application/atom+xml" title="Fight With Tools: A Dev Blog Feed" href="https://fightwithtools.dev/feed/" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Day 2: Building a tool to generate context pages</title>
        
            <!-- Sub Template: post -->
        
        
            <link rel="preload" as="font">
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="preload" as="style" />
            <link href="https://fightwithtools.dev/assets/prism-okaidia.css" rel="stylesheet" />
            <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=3830766044" /> -->
            <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/style.css?v=3830766044" id=""></link>

            
                <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=3830766044" /> -->
                <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-post.css?v=3830766044" id=""></link>

            
            <!-- Build Revision: 3830766044 & Sha: cf93bda09b23fe1e5ff8abadc94ee54568bc7360 -->
            <script src="https://fightwithtools.dev/assets/js/scale.fix.js" async></script>
            <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
            <!--[if lt IE 9]>
                <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
            <![endif]-->
        
        
            <!-- The Author meta propagates the byline in a number of social networks -->
<meta name="author" content="Aram Zucker-Scharff" />

<meta property="og:title"
    content="Day 2: Building a tool to generate context pages">

<meta property="og:description"
    content="I want to share lists of links, but make them readable and archived">


<meta property="og:url"
    content="https://fightwithtools.dev/posts/projects/context-pages/day-2/" />

<meta property="og:site_name" content="Fight With Tools: A Dev Blog" />

<meta property="og:locale" content="en_US" />

<meta name="twitter:site" content="@chronotope" />

<meta name="twitter:description" content="I want to share lists of links, but make them readable and archived" />

<meta name="description" content="I want to share lists of links, but make them readable and archived">

<!-- I prefer the summary_large_image Twitter card for posts. -->
<meta name="twitter:card" content="summary_large_image" />
<!-- You, you're the creator. -->
<meta name="twitter:creator" content="@chronotope" />
<!-- This property is for the article title, not site title. -->
<meta name="twitter:title" content="Day 2: Building a tool to generate context pages" />



<meta property="og:image" content="https://fightwithtools.dev/img/close-up-keys.jpg" />
<meta name="twitter:image" content="https://fightwithtools.dev/img/close-up-keys.jpg" />




    <!-- Article specific OG data -->
    <!-- The OG:Type dictates a number of other tags on posts. -->
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="Sun, 09 Jan 2022 02:59:43 GMT" />

    <!-- page.modified isn't a natural Jekyll property, but it can be added. -->
    

    <!-- Here my author and publisher tags are the same (yay self-publishing) -->
    <meta property="article:author" content="http://facebook.com/aramzs" />
    <!-- But if your site has its own page, this is where to put it. -->
    <meta property="article:publisher" content="https://www.facebook.com/aramzs" />

    
    <!-- Article section isn't a required property, but it can be good to have -->
    <meta property="article:section" content="Context Pages" />
    

    
        <!-- I use the page.categories property for OG tags. -->
        
        <meta property="article:tag" content="posts" />
        
        <meta property="article:tag" content="projects" />
        
        <meta property="article:tag" content="11ty" />
        
        <meta property="article:tag" content="Node" />
        
        <meta property="article:tag" content="WiP" />
        
        <meta property="article:tag" content="fetch" />
        
        <meta name="keywords" content="posts, projects, 11ty, Node, WiP, fetch">
    



            <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Blog",
        "url": "https://fightwithtools.dev/posts/projects/context-pages/day-2/",
        "headline": "Day 2: Building a tool to generate context pages",
        "about": "I want to share lists of links, but make them readable and archived",
        "image": [
            "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
        ],
        "isAccessibleForFree": "True",
        "isPartOf": {
            "@type": ["CreativeWork", "Product"],
            "name": "Fight With Tools",
            "productID": "fightwithtools.dev"
        },
        "discussionUrl": "https://twitter.com/search?q=to%3AChronotope%20%23dev&src=typed_query&f=top",
        "author": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Lead Privacy Engineer at The Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": "https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg"
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
}, 
        "editor": {
    "@type": "Person",
    "name": {
        "@type": "PronounceableText",
        "inLanguage": "en-US",
        "textValue": "Aram Zucker-Scharff",
        "speechToTextMarkup": "IPA",
        "phoneticText": "/ˌæ.ɹəm ˈt͡sʊ.kɚ 'ʃɑɹf/"
    },
    "description": "Aram Zucker-Scharff is Lead Privacy Engineer at The Washington Post, lead dev for PressForward and a consultant. Tech solutions for journo problems.",
    "disambiguatingDescription": "A media-focused developer and strategist.",
    "sameAs": "http://aramzs.github.io/aramzs/",
    "image": {
        "@type": "ImageObject",
        "url": "https://raw.githubusercontent.com/AramZS/aramzs.github.io/master/_includes/Aram-Zucker-Scharff-square.jpg"
    },
    "givenName": "Aram",
    "familyName": "Zucker-Scharff",
    "alternateName": "AramZS",
    "publishingPrinciples": "http://aramzs.github.io/about/"
},
        "inLanguage": "en-US",
        "license": "http://creativecommons.org/licenses/by-sa/4.0/",
        "additionalType": "CreativeWork",
        "alternateName": "Fight With Tools Dev",
        "publisher": {
            "@type": "Organization",
            "name": "Fight With Tools",
            "description": "A site discussing how to imagine, build, analyze and use cool code and web tools. Better websites, better stories, better developers. Technology won't save the world, but you can.",
            "sameAs": "https://fightwithtools.dev/",
            "logo": {
                "@type": "ImageObject",
                "url": "https://41.media.tumblr.com/709bb3c371b9924add351bfe3386e946/tumblr_nxdq8uFdx81qzocgko1_1280.jpg"
            },
            "publishingPrinciples": "http://aramzs.github.io/about/"
        }
    }
</script>

        
        
        
<link rel="canonical" href="https://fightwithtools.dev/posts/projects/context-pages/day-2/" />

        </head>
        <body itemscope itemtype="https://schema.org/Blog">
            <div class="wrapper">
                <header>
                    
                        
                            <div id="site-name-subhead">
                                <a href="https://fightwithtools.dev">Fight With Tools: A Dev Blog</a>
                                
                                    > <a id="project-link" href="https://fightwithtools.dev/projects/context-pages">Context Pages</a>
                                
                            </div>
                        
                        
                            <!-- post mode -->
                            <time>Sun Jan 09 2022</time>
                            <!-- front matter dates made in format at https://yaml.org/type/timestamp.html -->
                        
                        
                            <!-- projects mode -->
                        
                        <h1 class="header">
                            Day 2: Building a tool to generate context pages
                        </h1>
                        
                        
                    
                    
    <h5 itemprop="author" itemscope itemtype="https://schema.org/Person">
    <link itemprop="sameAs" href="http://aramzs.github.io/aramzs/" />
    By <span itemprop="name"><a href="http://aramzs.github.io/aramzs/" target="_blank">Aram Zucker-Scharff</a></span>
</h5>

                </header>
                <main>
                    
    <section id="precontent">
        <aside id="toc-container">
            <div id="toc-container__inner">
                <h2>Contents</h2>
                <nav class="toc">
        <ol><li><a href="#project-scope-and-todos">Project Scope and ToDos</a></li><li><a href="#day-2">Day 2</a></li></ol></nav>
            </div>
        </aside>
        <div id="post-description">I want to share lists of links, but make them readable and archived</div>

        
    <figure class="figure preview-image">
        <img src="https://fightwithtools.dev/img/close-up-keys.jpg" alt="Close up photo of keyboard keys.">
        
            <figcaption class="figcaption">
                
                 | <em>
                        <a href="https://www.flickr.com/photos/40393390@N00/2386752252" target="_blank">'TYPE' by SarahDeer is licensed with CC BY 2.0</a>
                    </em> | 
            </figcaption>
        
    </figure>


    </section>

                    <section id="maincontent" class="maincontent">
                    
                        <h2 id="project-scope-and-todos" tabindex="-1">Project Scope and ToDos</h2>
<ol>
<li>Take a link and turn it into an oEmbed/Open Graph style share card</li>
<li>Take a link and archive it in the most reliable way</li>
<li>When the link is a tweet, display the tweet but also the whole tweet thread.</li>
<li>When the link is a tweet, archive the tweets, and display them if the live ones are not available.</li>
<li>Capture any embedded retweets in the thread. Capture their thread if one exists</li>
<li>Capture any links in the Tweet</li>
<li>Create the process as an abstract function that returns the data in a savable way</li>
</ol>
<ul class="task-list">
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"></input> Archive links on <a href="http://Archive.org" target="_blank">Archive.org</a> and save the resulting archival links</li>
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"></input> Create link IDs that can be used to cache related content</li>
<li class="task-list-item"><input disabled="true" type="checkbox" class="markdown-todo"></input> Integrate it into the site to be able to make context pages here.</li>
</ul>
<h2 id="day-2" tabindex="-1">Day 2</h2>
<p>Ok, let's set up the request process. I want to retrieve the page so let's move forward on that as the next step.</p>
<p>Fetch is increasingly the way to handle HTTP requests in the browser, so it would be a good library to play with. Luckily there is a <a href="https://www.npmjs.com/package/node-fetch" target="_blank">Node Fetch library</a> I can leverage.</p>
<p>If I want to use fetch v3 it looks like this is how I have to go</p>
<p class="skip-link-graf">
<a href="#code-skip-day-2-5" id="skip-to-code-skip-day-2-5" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">fetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>	<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"node-fetch"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> fetch <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>`</code></pre>
<p id="code-skip-day-2-5">The other thing I know from working on PressForward is that requests will often get blocked if they look too much like a bot, so it is helpful to purposefully identify yourself as a trusted bot. There's <a href="https://user-agents.net/lookup" target="_blank">a list of UAs that I could search</a>, but I know from experiance that the most successful User Agent is Facebook's, especially when I'm trying to retrieve page metadata. So let's start there.</p>
<p>I also want to check for errors.</p>
<p>Let's use the advised pattern on the module page to start with. The logic here is that a response can still be &quot;successful&quot; even if it comes back with an error code. Their pattern should be able to catch that.</p>
<p>Ok, here's my code now:</p>
<p class="skip-link-graf">
<a href="#code-skip-day-2-4" id="skip-to-code-skip-day-2-4" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><br><span class="token keyword">const</span> <span class="token function-variable function">fetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>	<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"node-fetch"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> fetch <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> ua <span class="token operator">=</span><br>	<span class="token string">"facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">getRequestHeaders</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token punctuation">{</span><br>		cookie<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>		<span class="token string">"Accept-Language"</span><span class="token operator">:</span> <span class="token string">"en-US,en;q=0.8"</span><span class="token punctuation">,</span><br>		<span class="token string">"User-Agent"</span><span class="token operator">:</span> ua<span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HTTPResponseError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span><br>	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token keyword">super</span><span class="token punctuation">(</span><br>			<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">HTTP Error Response: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>statusText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>			<span class="token operator">...</span>args<br>		<span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> response<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">checkStatus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token comment">// response.status >= 200 &amp;&amp; response.status &lt; 300</span><br>		<span class="token keyword">return</span> response<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HTTPResponseError</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">fetchUrl</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">try</span> <span class="token punctuation">{</span><br>		<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>			method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span><br>			header<span class="token operator">:</span> <span class="token function">getRequestHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Fetch Error"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br>	<span class="token function">checkStatus</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-day-2-4">Let's add this to the module export and see if some basic requests work. Let's make a basic request that we know will respond to the GitHub API. Getting the head of this project's main commit tree should work just fine. Let's request <code>https://api.github.com/repos/AramZS/devblog/git/refs/heads/main</code>.</p>
<p>Ok, so what does a fetch returned object look like?</p>
<p class="skip-link-graf">
<a href="#code-skip-day-2-3" id="skip-to-code-skip-day-2-3" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>  type<span class="token operator">:</span> <span class="token string">'default'</span><span class="token punctuation">,</span><br>  url<span class="token operator">:</span> <span class="token string">'https://api.github.com/repos/AramZS/devblog/git/refs/heads/main'</span><span class="token punctuation">,</span><br>  status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span><br>  ok<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  redirected<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>  statusText<span class="token operator">:</span> <span class="token string">'OK'</span><span class="token punctuation">,</span><br>  headers<span class="token operator">:</span><br>   <span class="token punctuation">{</span> get<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> get<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     forEach<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> forEach<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     values<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> values<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     entries<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> entries<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     append<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     <span class="token keyword">delete</span><span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     getAll<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     has<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     set<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     sort<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> sort<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     keys<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  clone<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> clone<span class="token punctuation">]</span><span class="token punctuation">,</span><br>  body<span class="token operator">:</span><br>   <span class="token punctuation">{</span> _writeState<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _readableState<span class="token operator">:</span><br>      <span class="token punctuation">{</span> objectMode<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        highWaterMark<span class="token operator">:</span> <span class="token number">16384</span><span class="token punctuation">,</span><br>        buffer<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        length<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>        pipes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        flowing<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        ended<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        endEmitted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        reading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        constructed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        sync<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        needReadable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        emittedReadable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        readableListening<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        resumeScheduled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        errorEmitted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        emitClose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        autoDestroy<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        destroyed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        errored<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        closed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        closeEmitted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        defaultEncoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span><br>        awaitDrainWriters<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        multiAwaitDrain<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        readingMore<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        dataEmitted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        decoder<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        encoding<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>     _events<span class="token operator">:</span><br>      <span class="token punctuation">{</span> prefinish<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> prefinish<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        close<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        end<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> onend<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        finish<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        error<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        unpipe<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> onunpipe<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>     _eventsCount<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span><br>     _maxListeners<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span><br>     _writableState<span class="token operator">:</span><br>      <span class="token punctuation">{</span> objectMode<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        highWaterMark<span class="token operator">:</span> <span class="token number">16384</span><span class="token punctuation">,</span><br>        finalCalled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        needDrain<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        ending<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        ended<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        finished<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        destroyed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        decodeStrings<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        defaultEncoding<span class="token operator">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span><br>        length<span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span><br>        writing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        corked<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>        sync<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        bufferProcessing<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        onwrite<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> bound onwrite<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        writecb<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> nop<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        writelen<span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span><br>        afterWriteTickInfo<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        buffered<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        bufferedIndex<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>        allBuffers<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        allNoop<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        pendingcb<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><br>        constructed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        prefinished<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        errorEmitted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        emitClose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        autoDestroy<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        errored<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        closed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        closeEmitted<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        getBuffer<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> getBuffer<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>     allowHalfOpen<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>     bytesWritten<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>     _handle<span class="token operator">:</span><br>      <span class="token punctuation">{</span> onerror<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> zlibOnError<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        buffer<span class="token operator">:</span> <span class="token operator">&lt;</span>Buffer <span class="token number">1</span>f <span class="token number">8</span>b <span class="token number">08</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">03</span> <span class="token number">9</span>d <span class="token number">8</span>e <span class="token number">3</span>f <span class="token number">6</span>b c3 <span class="token number">30</span> <span class="token number">10</span> <span class="token number">47</span> bf <span class="token number">8</span>b e6 <span class="token number">10</span> d9 <span class="token number">8</span>e <span class="token number">89</span> <span class="token number">6</span>b <span class="token number">43</span> <span class="token number">86</span> <span class="token number">40</span> e9 <span class="token number">9</span>f <span class="token number">80</span> <span class="token number">92</span> a1 <span class="token number">34</span> <span class="token number">05</span> <span class="token number">2</span>f e5 <span class="token number">24</span> <span class="token number">9</span>d <span class="token number">2</span>d <span class="token number">15</span> cb <span class="token number">12</span> <span class="token number">96</span> <span class="token number">62</span> a8 <span class="token number">43</span> be <span class="token number">7</span>b <span class="token operator">...</span> <span class="token number">11</span> more bytes<span class="token operator">></span><span class="token punctuation">,</span><br>        cb<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        availOutBefore<span class="token operator">:</span> <span class="token number">16384</span><span class="token punctuation">,</span><br>        availInBefore<span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span><br>        inOff<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>        flushFlag<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>        write<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> write<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        writeSync<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> writeSync<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        close<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> close<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        init<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> init<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        params<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> params<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        reset<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> reset<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        getAsyncId<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> getAsyncId<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        asyncReset<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> asyncReset<span class="token punctuation">]</span><span class="token punctuation">,</span><br>        getProviderType<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> getProviderType<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>     _outBuffer<span class="token operator">:</span> <span class="token operator">&lt;</span>Buffer <span class="token number">7</span>b <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> c3 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> e0 bd <span class="token number">80</span> f2 e8 <span class="token number">7</span>f <span class="token number">00</span> <span class="token number">00</span> <span class="token number">20</span> b8 <span class="token number">80</span> f2 e8 <span class="token number">7</span>f <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token operator">...</span> <span class="token number">16334</span> more bytes<span class="token operator">></span><span class="token punctuation">,</span><br>     _outOffset<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>     _chunkSize<span class="token operator">:</span> <span class="token number">16384</span><span class="token punctuation">,</span><br>     _defaultFlushFlag<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>     _finishFlushFlag<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><br>     _defaultFullFlushFlag<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>     _info<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span><br>     _maxOutputLength<span class="token operator">:</span> <span class="token number">4294967296</span><span class="token punctuation">,</span><br>     _level<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><br>     _strategy<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>     params<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> params<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _closed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>     bytesRead<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><br>     reset<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _flush<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _final<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     flush<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     close<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _destroy<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _transform<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _processChunk<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _write<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _read<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     write<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     cork<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     uncork<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     setDefaultEncoding<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> setDefaultEncoding<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _writev<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>     end<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     destroy<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> destroy<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     _undestroy<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> undestroy<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     push<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     unshift<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     isPaused<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     setEncoding<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     read<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     pipe<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     unpipe<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     on<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     addListener<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     removeListener<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     off<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     removeAllListeners<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     resume<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     pause<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     wrap<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     iterator<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     setMaxListeners<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> setMaxListeners<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     getMaxListeners<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> getMaxListeners<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     emit<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> emit<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     prependListener<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> prependListener<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     once<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> once<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     prependOnceListener<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> prependOnceListener<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     listeners<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> listeners<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     rawListeners<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> rawListeners<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     listenerCount<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> listenerCount<span class="token punctuation">]</span><span class="token punctuation">,</span><br>     eventNames<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> eventNames<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  bodyUsed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>  arrayBuffer<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> arrayBuffer<span class="token punctuation">]</span><span class="token punctuation">,</span><br>  blob<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> blob<span class="token punctuation">]</span><span class="token punctuation">,</span><br>  json<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> json<span class="token punctuation">]</span><span class="token punctuation">,</span><br>  text<span class="token operator">:</span> <span class="token punctuation">[</span>Function<span class="token operator">:</span> text<span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre>
<p id="code-skip-day-2-3">Ok, this is pretty standard, we can get the body as JSON or as Text by using awaited functions. So I can check for a string that I expect inside that text and that will be there no matter when I make the HTTP request.</p>
<p class="skip-link-graf">
<a href="#code-skip-day-2-2" id="skip-to-code-skip-day-2-2" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"handle basic requests"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should resolve a basic URL"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>			<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">linkModule</span><span class="token punctuation">(</span><br>				<span class="token string">"https://api.github.com/repos/AramZS/devblog/git/refs/heads/main"</span><br>			<span class="token punctuation">)</span><span class="token punctuation">;</span><br>			result<span class="token punctuation">.</span>status<span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<span class="token keyword">const</span> textResponse <span class="token operator">=</span> <span class="token keyword">await</span> result<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>textResponse<span class="token punctuation">)</span><span class="token punctuation">;</span><br>			textResponse<br>				<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><br>					<span class="token string">'"url":"https://api.github.com/repos/AramZS/devblog/git/refs/heads/main"'</span><br>				<span class="token punctuation">)</span><br>				<span class="token punctuation">.</span>should<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p id="code-skip-day-2-2">That works! This is a good test.</p>
<p>Ok, I want to look up how to create oEmbeds (where they're available). I've done a lot with scraping pages but I've never done oEmbed. How does it work? Let's look around.</p>
<p>It looks like the standard is described in a pretty basic way <a href="https://oembed.com/" target="_blank">here</a>. It looks like <a href="https://github.com/WordPress/wordpress-develop/blob/5.8.1/src/wp-includes/embed.php#L25-L28" target="_blank">the relevant code for WordPress is over here</a>. There are two popular options <a href="https://www.npmjs.com/package/oembed" target="_blank">oembed</a> and <a href="https://www.npmjs.com/package/oembed-parser" target="_blank">oembed-parser</a>.</p>
<p>This is interesting. I'd always assumed oEmbeds were based off HEAD data, but it looks like sites declare an endpoint from which to retrieve them?</p>
<p><code>oembed-parser</code> looks up to date and well maintained. I think I'll try pulling that in.</p>
<p>It looks like, should any of the links be Facebook, I'll need a Facebook API key. I want to design this to be extended to other projects, so let's set up the function that way.</p>
<p>And Now we have a pretty basic oEmbed functionality. Let's see what I get as a test result.</p>
<p>Ok, first step is to log the result. Here's what I get</p>
<p class="skip-link-graf">
<a href="#code-skip-day-2-1" id="skip-to-code-skip-day-2-1" class="skip-link">Skip code block ▼</a></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span><br>  type<span class="token operator">:</span> <span class="token string">'photo'</span><span class="token punctuation">,</span><br>  flickr_type<span class="token operator">:</span> <span class="token string">'photo'</span><span class="token punctuation">,</span><br>  title<span class="token operator">:</span> <span class="token string">'upload'</span><span class="token punctuation">,</span><br>  author_name<span class="token operator">:</span> <span class="token string">'AramZS'</span><span class="token punctuation">,</span><br>  author_url<span class="token operator">:</span> <span class="token string">'https://www.flickr.com/photos/aramzs/'</span><span class="token punctuation">,</span><br>  width<span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span><br>  height<span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span><br>  url<span class="token operator">:</span> <span class="token string">'https://live.staticflickr.com/2941/33763840540_481ce97db2_z.jpg'</span><span class="token punctuation">,</span><br>  web_page<span class="token operator">:</span> <span class="token string">'https://www.flickr.com/photos/aramzs/33763840540/'</span><span class="token punctuation">,</span><br>  thumbnail_url<span class="token operator">:</span> <span class="token string">'https://live.staticflickr.com/2941/33763840540_481ce97db2_q.jpg'</span><span class="token punctuation">,</span><br>  thumbnail_width<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span><br>  thumbnail_height<span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span><br>  web_page_short_url<span class="token operator">:</span> <span class="token string">'https://flic.kr/p/TrAvtJ'</span><span class="token punctuation">,</span><br>  license<span class="token operator">:</span> <span class="token string">'Attribution License'</span><span class="token punctuation">,</span><br>  license_url<span class="token operator">:</span> <span class="token string">'https://creativecommons.org/licenses/by/2.0/'</span><span class="token punctuation">,</span><br>  license_id<span class="token operator">:</span> <span class="token string">'4'</span><span class="token punctuation">,</span><br>  html<span class="token operator">:</span> <span class="token string">'&lt;a data-flickr-embed="true" href="https://www.flickr.com/photos/aramzs/33763840540/" title="upload by AramZS, on Flickr">&lt;img src="https://live.staticflickr.com/2941/33763840540_481ce97db2_z.jpg" width="640" height="640" alt="upload">&lt;/a>&lt;script async src="https://embedr.flickr.com/assets/client-code.js" charset="utf-8">&lt;/script>'</span><span class="token punctuation">,</span><br>  version<span class="token operator">:</span> <span class="token string">'1.0'</span><span class="token punctuation">,</span><br>  cache_age<span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span><br>  provider_name<span class="token operator">:</span> <span class="token string">'Flickr'</span><span class="token punctuation">,</span><br>  provider_url<span class="token operator">:</span> <span class="token string">'https://www.flickr.com/'</span><br><span class="token punctuation">}</span></code></pre>
<p id="code-skip-day-2-1">Ok, I can test for that. I should really modal the response instead of making an actual HTTP request, but for now this is a good place to be. Last thing I want to test is <a href="https://developers.facebook.com/docs/features-reference/oembed-read" target="_blank">if it can make a request to Facebook</a>.</p>
<p>Hmm, trying some URLs and all I'm getting is <code>nulls</code>. That's annoying.</p>
<p>Ok, well, I'm hungry for dinner, so let's stop here.</p>
<p><a target="_blank" href="https://github.com/AramZS/contexter/commit/c9f9149e61ecf9d17b836e81b5b7040a8804c43c" class="git-commit-link"><code>git commit -am &quot;Getting the Link Request modules requesting and testing oembed&quot;</code></a></p>

                    
                    </section>
                    <section id="postcontent">
                    
    
        
        
        <div class="pagination">
            <a href="/posts/projects/context-pages/day-1/" class="pagination-link cursor-pointer ">Previous Day</a>

            <a href="/posts/projects/context-pages/day-3-wrestling-oembed-link-metadata/" class="pagination-link cursor-pointer ">Next Day</a>
        </div>
    
    <div class="social-icons-block">
    <div class="a-social-icon">
        <a href="https://github.com/AramZS/" target="_blank">
            <svg role="img" viewBox="0 0 24 24" class="twitter-icon social-icon" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>


<!-- https://simpleicons.org/?q=github -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://bit.ly/aramzs" target="_blank">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>


<!-- https://simpleicons.org/?q=linked -->

        </a>
    </div>
    <div class="a-social-icon">
        <a href="https://twitter.com/Chronotope" target="_blank">
            <svg role="img" class="twitter-icon social-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>

<!-- https://simpleicons.org/?q=tw -->

        </a>
    </div>
    
    <div class="a-social-icon">
        <a href="https://indieweb.social/@Chronotope" rel="me" target="_blank">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.193 7.88c0-5.207-3.411-6.733-3.411-6.733C18.062.357 15.108.025 12.041 0h-.076c-3.069.025-6.02.357-7.74 1.147 0 0-3.412 1.526-3.412 6.732 0 1.193-.023 2.619.015 4.13.124 5.092.934 10.11 5.641 11.355 2.17.574 4.034.695 5.536.612 2.722-.15 4.25-.972 4.25-.972l-.09-1.975s-1.945.613-4.13.54c-2.165-.075-4.449-.234-4.799-2.892a5.5 5.5 0 0 1-.048-.745s2.125.52 4.818.643c1.646.075 3.19-.097 4.758-.283 3.007-.359 5.625-2.212 5.954-3.905.517-2.665.475-6.508.475-6.508zm-4.024 6.709h-2.497v-6.12c0-1.29-.543-1.944-1.628-1.944-1.2 0-1.802.776-1.802 2.313v3.349h-2.484v-3.35c0-1.537-.602-2.313-1.802-2.313-1.085 0-1.628.655-1.628 1.945v6.119H4.831V8.285c0-1.29.328-2.314.987-3.07.68-.759 1.57-1.147 2.674-1.147 1.278 0 2.246.491 2.886 1.474L12 6.585l.622-1.043c.64-.983 1.608-1.474 2.886-1.474 1.104 0 1.994.388 2.674 1.146.658.757.986 1.781.986 3.07v6.305z"/></svg>

<!-- https://simpleicons.org/?q=mastodon -->

        </a>
    </div>

</div>


                    </section>
                </main>
                <footer>
                    
    <div id="taglist">
        <h6>Tags: </h6>
        <ul><li>
                    <a href="https://fightwithtools.dev/tag/11ty">11ty</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/node">Node</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/wip">WiP</a>
                </li><li>
                    <a href="https://fightwithtools.dev/tag/fetch">fetch</a>
                </li></ul>
    </div>

                    
                        <p>
                            <small>Hosted on <a href="https://pages.github.com" target="_blank">GitHub Pages</a> based on <a href="https://github.com/pages-themes/dinky" target="_blank">the Dinky theme</a>. <a href="https://github.com/AramZS/devblog" target="_blank">See the code</a>.</small>
                        </p>
                    
                    
                </footer>
            </div>
            <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        </body>
    </html>
