

<!doctype html>
    <html lang="en-US" id="template-archives" class="base">
        <head>
        
        <script defer data-domain="fightwithtools.dev" src="https://plausible.io/js/plausible.js"></script>
        <link rel="alternate" type="application/rss+xml" title="Fight With Tools: A Dev Blog RSS" href="https://fightwithtools.dev/rss/" />
    	<link rel="alternate" type="application/atom+xml" title="Fight With Tools: A Dev Blog Feed" href="https://fightwithtools.dev/feed/" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Puppeteer HTML to PDF Generation with Node.js - RisingStack Engineering</title>
        
            <!-- Sub Template: archives -->
        
        <link rel="original" http-equiv href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" />
        
            
                <!-- <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-archives.css?v=3917344329" /> -->
                <link rel="stylesheet" href="https://fightwithtools.dev/assets/css/template-archives.css?v=3917344329" id=""></link>

            
        
        
            <link rel="canonical" href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" />
            

            <meta property="og:title"
                content="Puppeteer HTML to PDF Generation with Node.js - RisingStack Engineering">

            <meta property="og:description"
                content="Learn to generate a Puppeteer PDF document from a heavily styled React page using Node.js, headless Chrome and Docker.">


            <meta property="og:url"
                content="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" />

            <meta property="og:site_name" content="Fight With Tools: A Dev Blog" />

            <meta property="og:locale" content="en_US" />

            <meta name="twitter:site" content="@chronotope" />

            <meta name="twitter:description" content="Learn to generate a Puppeteer PDF document from a heavily styled React page using Node.js, headless Chrome and Docker." />

            <!-- I prefer the summary_large_image Twitter card for posts. -->
            <meta name="twitter:card" content="summary_large_image" />
            <!-- You, you're the creator. -->
            <meta name="twitter:creator" content="@chronotope" />
            <!-- This property is for the article title, not site title. -->
            <meta name="twitter:title" content="Puppeteer HTML to PDF Generation with Node.js - RisingStack Engineering" />

            

            <meta property="og:type" content="website" />

            <script type="application/ld+json">
                {
                    "@context": "http://schema.org",
                    "@type": "WebPage",
                    "url": "https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/",
                    "headline": "Puppeteer HTML to PDF Generation with Node.js - RisingStack Engineering",
                    "about": "Learn to generate a Puppeteer PDF document from a heavily styled React page using Node.js, headless Chrome and Docker.",

                    "image": [
                        
                        
                    ],
                    "isAccessibleForFree": "True",
                    "isPartOf": {
                        "@type": ["CreativeWork", "Product"],
                        "name": "Fight With Tools",
                        "productID": "fightwithtools.dev"
                    },
                    "license": "http://creativecommons.org/licenses/by-sa/4.0/",
                    "archivedAt": "https://fightwithtools.dev/timegate/https:/blog.risingstack.com/pdf-from-html-node-js-puppeteer/",
                    "sameAs": "https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/",
                }
            </script>


        
        
        </head>
        <body >
            <div class="wrapper">
                <header>
                    <div class="left">
                        <h1>Archived: Puppeteer HTML to PDF Generation with Node.js - RisingStack Engineering</h1>
                        <p>This is a simplified archive of the page at <a href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" target="_blank">https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/</a></p>
                    </div>

                            <div id="share-embed">
                                <span>Use this page embed on your own site:</span>
                                <textarea id="html-embed" name="story" rows="8" cols="40">
                                    <script>window.contexterSetup=window.contexterSetup||function(){window.contexterSetupComplete=!0;class ContexterLink extends HTMLAnchorElement{constructor(){super()}connectedCallback(){this.setAttribute("target","_blank")}}customElements.define("contexter-link",ContexterLink,{extends:"a"}),customElements.define("contexter-inner",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__inner"}}),customElements.define("contexter-thumbnail",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__thumbnail"}}),customElements.define("contexter-byline",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__byline"}}),customElements.define("contexter-keywordset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__keywordset"}}),customElements.define("contexter-linkset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__linkset"}}),customElements.define("contexter-meta",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__meta"}}),customElements.define("contexter-summary",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="p-summary entry-summary"}}),customElements.define("contexter-box-head",class extends HTMLElement{constructor(){super()}connectedCallback(){this.className="contexter-box__head"}}),customElements.define("contexter-box-inner",class extends HTMLElement{constructor(){super()}connectedCallback(){}});class ContexterBox extends HTMLElement{constructor(){super(),this.first=!0,this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){if(this.first){this.first=!1;var style=document.createElement("style"),lightDomStyle=(style.innerHTML=`:host {--background: #f5f6f7;--border: darkblue;--blue: #0000ee;--font-color: black;--inner-border: black;font-family: Franklin,Arial,Helvetica,sans-serif;font-size: 14px;background: var(--background);width: 600px;color: var(--font-color);min-height: 90px;display: block;padding: 8px;border: 1px solid var(--border);cursor: pointer;box-sizing: border-box;margin: 6px;contain: content;margin: 6px auto;}// can only select top-level nodes with slotted::slotted(*) {max-width: 100%;display:block;}::slotted([slot=thumbnail]) {max-width: 100%;display:block;}::slotted([slot=header]) {width: 100%;font-size: 1.25rem;font-weight: bold;display:block;margin-bottom: 6px;}::slotted([slot=author]) {max-width: 50%;font-size: 12px;display:inline-block;float: left;}::slotted([slot=time]) {max-width: 50%;font-size: 12px;display:inline-block;float: right;}::slotted([slot=summary]) {width: 100%;margin-top: 6px;padding: 10px 2px;border-top: 1px solid var(--inner-border);font-size: 15px;display:inline-block;margin-bottom: 6px;}contexter-meta {height: auto;margin-bottom: 4px;width: 100%;display: grid;position: relative;min-height: 16px;grid-template-columns: repeat(2, 1fr);}::slotted([slot=keywords]) {width: 80%;padding: 2px 4px;border-top: 1px solid var(--inner-border);font-size: 11px;display: block;float: right;font-style: italic;text-align: right;grid-column: 2/2;grid-row: 1;align-self: end;justify-self: end;}::slotted([slot=keywords]):empty {border-top: 0px solid var(--inner-border);}::slotted([slot=archive-link]) {font-size: 1em;display: inline;}::slotted([slot=archive-link])::after {content: "|";display: inline;color: var(--font-color);text-decoration: none;margin: 0 .5em;}::slotted([slot=read-link]) {font-size: 1em;display: inline;}contexter-linkset {width: 80%;padding: 2px 4px;font-size: 13px;float: left;font-weight: bold;grid-row: 1;grid-column: 1/2;align-self: end;justify-self: start;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {:host {width: 310px;}}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){:host {--background: #354150;--border: #1f2b37;--blue: #55b0ff;--font-color: #ffffff;--inner-border: #787a7c;background: var(--background);border: 1px solid var(--border)}}`,document.createElement("style"));lightDomStyle.innerHTML=`contexter-box {contain: content;}contexter-box .read-link {font-weight: bold;}contexter-box a {color: #0000ee;}contexter-box img {width: 100%;border: 0;padding: 0;margin: 0;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {...}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){contexter-box a {color: #55b0ff;}}`,this.appendChild(lightDomStyle),this.shadow.appendChild(style);const innerContainer=document.createElement("contexter-box-inner"),innerSlotThumbnail=(this.shadow.appendChild(innerContainer),document.createElement("slot")),innerSlotHeader=(innerSlotThumbnail.name="thumbnail",innerContainer.appendChild(innerSlotThumbnail),document.createElement("slot")),innerSlotAuthor=(innerSlotHeader.name="header",innerContainer.appendChild(innerSlotHeader),document.createElement("slot")),innerSlotTime=(innerSlotAuthor.name="author",innerContainer.appendChild(innerSlotAuthor),document.createElement("slot")),innerSlotSummary=(innerSlotTime.name="time",innerContainer.appendChild(innerSlotTime),document.createElement("slot")),metaContainer=(innerSlotSummary.name="summary",innerContainer.appendChild(innerSlotSummary),document.createElement("contexter-meta")),innerSlotInfo=(innerContainer.appendChild(metaContainer),document.createElement("slot")),linkContainer=(innerSlotInfo.name="keywords",metaContainer.appendChild(innerSlotInfo),document.createElement("contexter-linkset")),innerSlotArchiveLink=(metaContainer.appendChild(linkContainer),document.createElement("slot")),innerSlotReadLink=(innerSlotArchiveLink.name="archive-link",linkContainer.appendChild(innerSlotArchiveLink),document.createElement("slot"));innerSlotReadLink.name="read-link",linkContainer.appendChild(innerSlotReadLink),this.className="contexter-box",this.onclick=e=>{if(!e.target.className.includes("read-link")&&!e.target.className.includes("title-link")){const mainLinks=this.querySelectorAll("a.main-link");mainLinks[0].click()}}}}}customElements.define("contexter-box",ContexterBox)},window.contexterSetupComplete||window.contexterSetup();</script><contexter-box class="link-card h-entry hentry" itemscope="" itemtype="https://schema.org/CreativeWork"><contexter-thumbnail class="thumbnail" slot="thumbnail"></contexter-thumbnail><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><a is="contexter-link" href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" itemprop="url">Puppeteer HTML to PDF Generation with Node.js - RisingStack Engineering</a></contexter-box-head></contexter-box-head><time class="dt-published published" slot="time" itemprop="datePublished" datetime="2021-09-23T08:53:51.000Z">8/23/2021</time><contexter-summary class="p-summary entry-summary" itemprop="abstract" slot="summary"><p>Learn to generate a Puppeteer PDF document from a heavily styled React page using Node.js, headless Chrome and Docker.</p></contexter-summary><contexter-keywordset itemprop="keywords" slot="keywords"></contexter-keywordset><a is="contexter-link" href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" class="read-link main-link" itemprop="sameAs" slot="read-link">Read</a><a href="https://fightwithtools.dev/timegate/https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" is="contexter-link" target="_blank" class="read-link archive-link" itemprop="archivedAt" slot="archive-link">Archived</a></contexter-box>
                                </textarea><br />
                                <button onclick="(function(e){ navigator.clipboard.writeText(document.getElementById('html-embed').value); })()">Copy</button>
                            </div>
                            
                            <script>window.contexterSetup=window.contexterSetup||function(){window.contexterSetupComplete=!0;class ContexterLink extends HTMLAnchorElement{constructor(){super()}connectedCallback(){this.setAttribute("target","_blank")}}customElements.define("contexter-link",ContexterLink,{extends:"a"}),customElements.define("contexter-inner",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__inner"}}),customElements.define("contexter-thumbnail",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__thumbnail"}}),customElements.define("contexter-byline",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__byline"}}),customElements.define("contexter-keywordset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__keywordset"}}),customElements.define("contexter-linkset",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__linkset"}}),customElements.define("contexter-meta",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="contexter-box__meta"}}),customElements.define("contexter-summary",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className="p-summary entry-summary"}}),customElements.define("contexter-box-head",class extends HTMLElement{constructor(){super()}connectedCallback(){this.className="contexter-box__head"}}),customElements.define("contexter-box-inner",class extends HTMLElement{constructor(){super()}connectedCallback(){}});class ContexterBox extends HTMLElement{constructor(){super(),this.first=!0,this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){if(this.first){this.first=!1;var style=document.createElement("style"),lightDomStyle=(style.innerHTML=`:host {--background: #f5f6f7;--border: darkblue;--blue: #0000ee;--font-color: black;--inner-border: black;font-family: Franklin,Arial,Helvetica,sans-serif;font-size: 14px;background: var(--background);width: 600px;color: var(--font-color);min-height: 90px;display: block;padding: 8px;border: 1px solid var(--border);cursor: pointer;box-sizing: border-box;margin: 6px;contain: content;margin: 6px auto;}// can only select top-level nodes with slotted::slotted(*) {max-width: 100%;display:block;}::slotted([slot=thumbnail]) {max-width: 100%;display:block;}::slotted([slot=header]) {width: 100%;font-size: 1.25rem;font-weight: bold;display:block;margin-bottom: 6px;}::slotted([slot=author]) {max-width: 50%;font-size: 12px;display:inline-block;float: left;}::slotted([slot=time]) {max-width: 50%;font-size: 12px;display:inline-block;float: right;}::slotted([slot=summary]) {width: 100%;margin-top: 6px;padding: 10px 2px;border-top: 1px solid var(--inner-border);font-size: 15px;display:inline-block;margin-bottom: 6px;}contexter-meta {height: auto;margin-bottom: 4px;width: 100%;display: grid;position: relative;min-height: 16px;grid-template-columns: repeat(2, 1fr);}::slotted([slot=keywords]) {width: 80%;padding: 2px 4px;border-top: 1px solid var(--inner-border);font-size: 11px;display: block;float: right;font-style: italic;text-align: right;grid-column: 2/2;grid-row: 1;align-self: end;justify-self: end;}::slotted([slot=keywords]):empty {border-top: 0px solid var(--inner-border);}::slotted([slot=archive-link]) {font-size: 1em;display: inline;}::slotted([slot=archive-link])::after {content: "|";display: inline;color: var(--font-color);text-decoration: none;margin: 0 .5em;}::slotted([slot=read-link]) {font-size: 1em;display: inline;}contexter-linkset {width: 80%;padding: 2px 4px;font-size: 13px;float: left;font-weight: bold;grid-row: 1;grid-column: 1/2;align-self: end;justify-self: start;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {:host {width: 310px;}}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){:host {--background: #354150;--border: #1f2b37;--blue: #55b0ff;--font-color: #ffffff;--inner-border: #787a7c;background: var(--background);border: 1px solid var(--border)}}`,document.createElement("style"));lightDomStyle.innerHTML=`contexter-box {contain: content;}contexter-box .read-link {font-weight: bold;}contexter-box a {color: #0000ee;}contexter-box img {width: 100%;border: 0;padding: 0;margin: 0;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {...}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){contexter-box a {color: #55b0ff;}}`,this.appendChild(lightDomStyle),this.shadow.appendChild(style);const innerContainer=document.createElement("contexter-box-inner"),innerSlotThumbnail=(this.shadow.appendChild(innerContainer),document.createElement("slot")),innerSlotHeader=(innerSlotThumbnail.name="thumbnail",innerContainer.appendChild(innerSlotThumbnail),document.createElement("slot")),innerSlotAuthor=(innerSlotHeader.name="header",innerContainer.appendChild(innerSlotHeader),document.createElement("slot")),innerSlotTime=(innerSlotAuthor.name="author",innerContainer.appendChild(innerSlotAuthor),document.createElement("slot")),innerSlotSummary=(innerSlotTime.name="time",innerContainer.appendChild(innerSlotTime),document.createElement("slot")),metaContainer=(innerSlotSummary.name="summary",innerContainer.appendChild(innerSlotSummary),document.createElement("contexter-meta")),innerSlotInfo=(innerContainer.appendChild(metaContainer),document.createElement("slot")),linkContainer=(innerSlotInfo.name="keywords",metaContainer.appendChild(innerSlotInfo),document.createElement("contexter-linkset")),innerSlotArchiveLink=(metaContainer.appendChild(linkContainer),document.createElement("slot")),innerSlotReadLink=(innerSlotArchiveLink.name="archive-link",linkContainer.appendChild(innerSlotArchiveLink),document.createElement("slot"));innerSlotReadLink.name="read-link",linkContainer.appendChild(innerSlotReadLink),this.className="contexter-box",this.onclick=e=>{if(!e.target.className.includes("read-link")&&!e.target.className.includes("title-link")){const mainLinks=this.querySelectorAll("a.main-link");mainLinks[0].click()}}}}}customElements.define("contexter-box",ContexterBox)},window.contexterSetupComplete||window.contexterSetup();</script><contexter-box class="link-card h-entry hentry" itemscope="" itemtype="https://schema.org/CreativeWork"><contexter-thumbnail class="thumbnail" slot="thumbnail"></contexter-thumbnail><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><contexter-box-head slot="header" class="p-name entry-title" itemprop="headline"><a is="contexter-link" href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" itemprop="url">Puppeteer HTML to PDF Generation with Node.js - RisingStack Engineering</a></contexter-box-head></contexter-box-head><time class="dt-published published" slot="time" itemprop="datePublished" datetime="2021-09-23T08:53:51.000Z">8/23/2021</time><contexter-summary class="p-summary entry-summary" itemprop="abstract" slot="summary"><p>Learn to generate a Puppeteer PDF document from a heavily styled React page using Node.js, headless Chrome and Docker.</p></contexter-summary><contexter-keywordset itemprop="keywords" slot="keywords"></contexter-keywordset><a is="contexter-link" href="https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" class="read-link main-link" itemprop="sameAs" slot="read-link">Read</a><a href="https://fightwithtools.dev/timegate/https://blog.risingstack.com/pdf-from-html-node-js-puppeteer/" is="contexter-link" target="_blank" class="read-link archive-link" itemprop="archivedAt" slot="archive-link">Archived</a></contexter-box>
                            


                </header>
                <main>
                
                    <div id="readability-page-1" class="page"><div data-id="a45b3e1" data-element_type="widget" data-widget_type="theme-post-content.default">
			
<p><strong>In this article I’m going to show how you can generate a Puppeteer PDF document from a heavily styled React web page using Node.js, headless Chrome &amp; Docker.</strong></p>



<p>Background: A few months ago one of the clients of&nbsp;<a href="https://risingstack.com/">RisingStack</a>&nbsp;asked us to develop a feature where the user would be able to request a React page in PDF format. That page is basically a report/result for patients with data visualization, containing a lot of SVGs. Furthermore, there were some special requests to manipulate the layout and make some rearrangements of the HTML elements. So the PDF should have different styling and additions compared to the original React page.</p>



<figure><img src="https://backup-blog.risingstack.com/content/images/2021/06/puppeteer_pdf.png" alt="puppeteer_pdf" data-old-src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3E%3C/svg%3E" data-lazy-src="https://backup-blog.risingstack.com/content/images/2021/06/puppeteer_pdf.png"></figure>



<p><strong>As the assignment was a bit more complex than what could have been solved with simple CSS rules, we first explored possible implementations. Essentially we found 3 main solutions. This blogpost will walk you through on these possibilities and the final implementations.</strong></p>



<p>A personal comment before we get started: it’s quite a hassle, so buckle up!</p>



<h2 id="tableofcontents">Table of Contents:</h2>



<ul><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#clientside">Client side or Backend side PDF generation?</a></li><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#option1">Option 1: Making a Screenshot from the DOM</a></li><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#option2">Option 2: Use only a PDF library</a></li><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#option3">Final option 3: Puppeteer, headless Chrome with Node.js</a><ul><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#style">Style manipulation</a></li><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#file">Send file to the client and save it</a></li></ul></li><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#puppeteer">Using Puppeteer with Docker</a></li><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#option31">Option 3 +1: CSS print rules</a></li><li><a href="https://backup-blog.risingstack.com/pdf-from-html-node-js-puppeteer/#summary">Summary</a></li></ul>



<h2 id="clientsideorserversidepdfgeneration">Client side or Server side PDF generation?</h2>



<p>It is possible to generate a PDF file both on the client-side and on the server-side. However, it probably makes more sense to let the backend handle it, as you don’t want to use up all the resources the user’s browser can offer.</p>



<p>Even so, I’ll still show solutions for both methods.</p>



<h2 id="option1makeascreenshotfromthedom">Option 1: Make a Screenshot from the DOM</h2>



<p>At first sight, this solution seemed to be the simplest, and it turned out to be true, but it has its own limitations. If you don’t have special needs, like selectable or searchable text in the PDF, it is a good and simple way to generate one.</p>



<p>This method is plain and simple: create a screenshot from the page, and put it in a PDF file. Pretty straightforward. We used two packages for this approach:</p>



<p><a href="https://html2canvas.hertzen.com/">Html2canvas</a>, to make a screenshot from the DOM<br><a href="https://github.com/MrRio/jsPDF">jsPdf</a>, a library to generate PDF</p>



<p>Let’s start coding.</p>



<p><code>npm install html2canvas jspdf</code></p>



<pre><code>import html2canvas from 'html2canvas'
import jsPdf from 'jspdf'
 
function printPDF () {
    const domElement = document.getElementById('your-id')
    html2canvas(domElement, { onclone: (document) =&gt; {
      document.getElementById('print-button').style.visibility = 'hidden'
    }})
    .then((canvas) =&gt; {
        const img = canvas.toDataURL('image/png')
        const pdf = new jsPdf()
        pdf.addImage(imgData, 'JPEG', 0, 0, width, height)
        pdf.save('your-filename.pdf')
})
</code></pre>



<p>And that’s it!</p>



<p>Make sure you take a look at the&nbsp;<code>html2canvas</code>&nbsp;<code>onclone</code>&nbsp;method. It can prove to be handy when you quickly need to take a snapshot and manipulate the DOM (e.g. hide the print button) before taking the picture. I can see quite a lot of use cases for this package. Unfortunately, ours wasn’t one, as we needed to handle the PDF creation on the backend side.</p>



<h2 id="option2useonlyapdflibrary">Option 2: Use only a PDF Library</h2>



<p>There are several libraries out there on NPM for this purpose, like jsPDF (mentioned above) or&nbsp;<a href="https://www.npmjs.com/package/pdfkit">PDFKit</a>. The problem with them that I would have to recreate the page structure again if I wanted to use these libraries. That definitely hurts maintainability, as I would have needed to apply all subsequent changes to both the PDF template and the React page.</p>



<p>Take a look at the code below. You need to create the PDF document yourself by hand. Now you could traverse the DOM and figure out how to translate each element to PDF ones, but that is a tedious job. There must be an easier way.</p>



<pre><code>doc = new PDFDocument
doc.pipe fs.createWriteStream('output.pdf')
doc.font('fonts/PalatinoBold.ttf')
   .fontSize(25)
   .text('Some text with an embedded font!', 100, 100)
 
doc.image('path/to/image.png', {
   fit: [250, 300],
   align: 'center',
   valign: 'center'
});
 
doc.addPage()
   .fontSize(25)
   .text('Here is some vector graphics...', 100, 100)
 
doc.end()
</code></pre>



<p>This snippet is from the PDFKit docs. However, it can be useful if your target is a PDF file straight away and not the conversion of an already existing (and ever-changing) HTML page.</p>



<h2 id="finaloption3puppeteerheadlesschromewithnodejs">Final Option 3: Puppeteer, Headless Chrome with Node.js</h2>



<p>What is&nbsp;<a href="https://github.com/GoogleChrome/puppeteer">Puppeteer</a>? The documentation says:</p>



<blockquote><p>Puppeteer is a Node library which provides a high-level API to control Chrome or Chromium over the DevTools Protocol. Puppeteer runs headless by default, but can be configured to run full (non-headless) Chrome or Chromium.</p></blockquote>



<p>It’s basically a browser which you can run from Node.js. If you read the docs, the first thing it says about Puppeteer is that you can use it to&nbsp;<strong>Generate screenshots and PDFs of pages</strong>’. Excellent! That’s what we were looking for.</p>



<p>Let’s install Puppeteer with&nbsp;<code>npmi i puppeteer</code>, and implement our use case.</p>



<pre><code>const puppeteer = require('puppeteer')
 
async function printPDF() {
  const browser = await puppeteer.launch({ headless: true });
  const page = await browser.newPage();
  await page.goto('https://blog.risingstack.com', {waitUntil: 'networkidle0'});
  const pdf = await page.pdf({ format: 'A4' });
 
  await browser.close();
  return pdf
})
</code></pre>



<p>This is a simple function that navigates to a URL and generates a PDF file of the site.</p>



<p>First, we launch the browser (PDF generation only supported in headless browser mode), then we open a new page, set the viewport size, and navigate to the provided URL.</p>



<p>Setting the&nbsp;<code>waitUntil: ‘networkidle0’</code>&nbsp;option means that Puppeteer considers navigation to be finished when there are no network connections for at least 500 ms. (Check&nbsp;<a href="https://github.com/GoogleChrome/puppeteer/blob/v1.11.0/docs/api.md">API docs</a>&nbsp;for further information.)</p>



<p><strong>After that, we save the PDF to a variable, we close the browser and return the PDF.</strong></p>



<p>Note: The&nbsp;<code>page.pdf</code>method receives an&nbsp;<code>options</code>&nbsp;object, where you can save the file to disk with the ‘path’ option as well. If path is not provided, the PDF won’t be saved to the disk, you’ll get a buffer instead. Later on, I discuss how you can handle it.)</p>



<p>In case you need to log in first to generate a PDF from a protected page, first you need to navigate to the login page, inspect the form elements for ID or name, fill them in, then submit the form:</p>



<pre><code>await page.type('#email', process.env.PDF_USER)
await page.type('#password', process.env.PDF_PASSWORD)
await page.click('#submit')
</code></pre>



<p>Always store login credentials in environment variables, do not hardcode them!</p>



<h3 id="stylemanipulation">Style Manipulation</h3>



<p>Puppeteer has a solution for this style manipulation too. You can insert style tags before generating the PDF, and Puppeteer will generate a file with the modified styles.</p>



<pre><code>await page.addStyleTag({ content: '.nav { display: none} .navbar { border: 0px} #print-button {display: none}' })
</code></pre>



<h3 id="sendfiletotheclientandsaveit">Send file to the client and save it</h3>



<p>Okay, now you have generated a PDF file on the backend. What to do now?</p>



<p>As I mentioned above, if you don’t save the file to disk, you’ll get a buffer. You just need to send that buffer with the proper content type to the front-end.</p>



<pre><code>printPDF().then(pdf =&gt; {
	res.set({ 'Content-Type': 'application/pdf', 'Content-Length': pdf.length })
	res.send(pdf)
})</code></pre>



<p>Now you can simply send a request to the server, to get the generated PDF.</p>



<pre><code>function getPDF() {
 return axios.get(`${API_URL}/your-pdf-endpoint`, {
   responseType: 'arraybuffer',
   headers: {
     'Accept': 'application/pdf'
   }
 })
</code></pre>



<p>Once you’ve sent the request, the buffer should start downloading. Now the last step is to convert the buffer into a PDF file.</p>



<pre><code>savePDF = () =&gt; {
    this.openModal(‘Loading…’) <em>// open modal</em>
   return getPDF() <em>// API call</em>
     .then((response) =&gt; {
       const blob = new Blob([response.data], {type: 'application/pdf'})
       const link = document.createElement('a')
       link.href = window.URL.createObjectURL(blob)
       link.download = `your-file-name.pdf`
       link.click()
       this.closeModal() <em>// close modal</em>
     })
   .catch(err =&gt; <em>/** error handling **/</em>)
 }
</code></pre>



<pre><code>&lt;button onClick={this.savePDF}&gt;Save as PDF&lt;/button&gt;
</code></pre>



<p>That was it! If you click on the save button, the PDF will be saved by the browser.</p>



<h2 id="usingpuppeteerwithdocker">Using Puppeteer with Docker</h2>



<p>I think this is the trickiest part of the implementation – so let me save you a couple of hours of Googling.</p>



<p>The official documentation states that&nbsp;<em>“getting headless Chrome up and running in Docker can be tricky”</em>. The official docs have a&nbsp;<a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md#running-puppeteer-in-docker">Troubleshooting</a>&nbsp;section, where at the time of writing you can find all the necessary information on installing puppeteer with Docker.</p>



<p>If you install Puppeteer on the Alpine image, make sure you scroll down a bit to&nbsp;<a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md#running-on-alpine">this part of the page</a>. Otherwise, you might gloss over the fact that you cannot run the latest Puppeteer version and you also need to disable shm usage, using a flag:</p>



<pre><code>const browser = await puppeteer.launch({
  headless: true,
  args: ['--disable-dev-shm-usage']
});
</code></pre>



<p>Otherwise, the Puppeteer sub process might run out of memory before it even gets started properly. More info about that on the troubleshooting link above.</p>



<h2 id="option31cssprintrules">Option 3 + 1: CSS Print Rules</h2>



<p>One might think that simply using CSS print rules is easy from a developers standpoint. No NPM or node modules, just pure CSS. But how do they fare when it comes to cross-browser compatibility?</p>



<p>When choosing CSS print rules, you have to test the outcome in every browser to make sure it provides the same layout, and it’s not 100% that it does.</p>



<p>For example, inserting a break after a given element cannot be considered an esoteric use case, yet you might be surprised that you need to use workarounds&nbsp;<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/break-after#Browser_compatibility">to get that working in Firefox</a>.</p>



<p>Unless you are a battle-hardened CSS magician with a lot of experience in creating printable pages, this can be time-consuming.</p>



<p>Print rules are great if you can keep the print stylesheets simple.</p>



<p>Let’s see an example.</p>



<pre><code>@media print {
    .print-button {
        display: none;
    }
    
    .content div {
        break-after: always;
    }
}
</code></pre>



<p>This CSS above hides the print button, and inserts a page break after every&nbsp;<code>div</code>&nbsp;with the class&nbsp;<code>content.</code>&nbsp;There is a&nbsp;<a href="https://www.smashingmagazine.com/2018/05/print-stylesheets-in-2018/">great article</a>&nbsp;that summarizes what you can do with print rules, and what are the difficulties with them including browser compatibility.</p>



<p>Taking everything into account, CSS print rules are great and effective if you want to make a PDF from a not so complex page.</p>



<h2 id="summarypuppeteerpdffromhtmlwithnodejs">Summary: Puppeteer PDF from HTML with Node.js</h2>



<p>So let’s quickly go through the options we covered here for generating PDF files from HTML pages:</p>



<ul><li><strong>Screenshot from the DOM</strong>: This can be useful when you need to create snapshots from a page (for example to create a thumbnail), but falls short when you have a lot of data to handle.</li><li><strong>Use only a PDF library</strong>: If you need to create PDF files programmatically from scratch, this is a perfect solution. Otherwise, you need to maintain the HTML and PDF templates which is definitely a no-go.</li><li><strong>Puppeteer</strong>: Despite being relatively difficult to get it working on Docker, it provided the best result for our use case, and it was also the easiest to write the code with.</li><li><strong>CSS print rules</strong>: If your users are educated enough to know how to print to a file and your pages are relatively simple, it can be the most painless solution. As you saw in our case, it wasn’t.</li></ul>



<p>Make sure to reach out to RisingStack when you need&nbsp;<a href="https://risingstack.com/nodejs-development-consulting-services">help with Node, React, or just JS in general</a>.</p>



<p>Have fun with your PDF HTML’s!</p>
		</div></div>
                
                </main>
                <footer>

                </footer>
            </div>
            <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        </body>
    </html>
